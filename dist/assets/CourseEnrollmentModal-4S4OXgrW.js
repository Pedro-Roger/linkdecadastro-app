import{j as e}from"./index-BAEh9e7U.js";import{d as i}from"./react-vendor-40RSlyA9.js";import{o as _,u as Z,Z as D,s as l,e as H}from"./form-vendor-UKDbifrO.js";import{t as K}from"./zod-Bd6eNPbn.js";import{a as X}from"./api-WS8dxZuR.js";const Y=["ESTUDANTE","PROFESSOR","PESQUISADOR","PRODUTOR"],ee=_({name:l().min(1,"Nome é obrigatório").optional(),email:l().email("Email inválido").optional(),password:l().min(6,"Senha deve ter no mínimo 6 caracteres").optional(),cpf:l().min(11,"CPF deve ter 11 dígitos"),birthDate:l().min(1,"Data de nascimento é obrigatória"),participantType:H(Y,{required_error:"Selecione o tipo de participante"}),hectares:l().optional(),state:l().min(2,"Estado é obrigatório"),city:l().min(1,"Cidade é obrigatória"),whatsappNumber:l().min(10,"Informe o WhatsApp com DDD")}),te=n=>ee.superRefine((s,u)=>{s.cpf.replace(/\D/g,"").length!==11&&u.addIssue({code:D.custom,message:"CPF deve ter 11 dígitos",path:["cpf"]});const g=s.whatsappNumber.replace(/\D/g,"");if((g.length<10||g.length>11)&&u.addIssue({code:D.custom,message:"Informe um número de WhatsApp válido (com DDD)",path:["whatsappNumber"]}),s.participantType==="PRODUTOR"){const w=parseFloat(s.hectares??"");(Number.isNaN(w)||w<=0)&&u.addIssue({code:D.custom,message:"Hectares é obrigatório para produtores e deve ser maior que zero",path:["hectares"]})}}),$=[{sigla:"AC",nome:"Acre"},{sigla:"AL",nome:"Alagoas"},{sigla:"AP",nome:"Amapá"},{sigla:"AM",nome:"Amazonas"},{sigla:"BA",nome:"Bahia"},{sigla:"CE",nome:"Ceará"},{sigla:"DF",nome:"Distrito Federal"},{sigla:"ES",nome:"Espírito Santo"},{sigla:"GO",nome:"Goiás"},{sigla:"MA",nome:"Maranhão"},{sigla:"MT",nome:"Mato Grosso"},{sigla:"MS",nome:"Mato Grosso do Sul"},{sigla:"MG",nome:"Minas Gerais"},{sigla:"PA",nome:"Pará"},{sigla:"PB",nome:"Paraíba"},{sigla:"PR",nome:"Paraná"},{sigla:"PE",nome:"Pernambuco"},{sigla:"PI",nome:"Piauí"},{sigla:"RJ",nome:"Rio de Janeiro"},{sigla:"RN",nome:"Rio Grande do Norte"},{sigla:"RS",nome:"Rio Grande do Sul"},{sigla:"RO",nome:"Rondônia"},{sigla:"RR",nome:"Roraima"},{sigla:"SC",nome:"Santa Catarina"},{sigla:"SP",nome:"São Paulo"},{sigla:"SE",nome:"Sergipe"},{sigla:"TO",nome:"Tocantins"}];function se(n){return n.replace(/\D/g,"").slice(0,11).replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d{1,2})$/,"$1-$2")}function ae(n){const s=n.replace(/\D/g,"").slice(0,11);return s.length<=2?s:s.length<=6?`(${s.slice(0,2)}) ${s.slice(2)}`:s.length<=10?`(${s.slice(0,2)}) ${s.slice(2,6)}-${s.slice(6)}`:`(${s.slice(0,2)}) ${s.slice(2,7)}-${s.slice(7)}`}function ce({isOpen:n,onClose:s,courseId:u,courseTitle:k,onSuccess:g}){const U=i.useMemo(()=>te(),[!1]),{register:c,handleSubmit:L,watch:E,setValue:h,reset:x,formState:{errors:a}}=Z({resolver:K(U),defaultValues:{name:"",email:"",state:"",city:"",whatsappNumber:""},shouldUnregister:!0}),d=E("state"),B=E("participantType"),[G,S]=i.useState([]),[V,b]=i.useState([]),[T,C]=i.useState(!1),[P,F]=i.useState(!1),[A,I]=i.useState(!1),[z,W]=i.useState(!1),[O,f]=i.useState(null),[m,y]=i.useState(null);i.useEffect(()=>{n&&(J(),y(null),f(null),x(t=>({...t,whatsappNumber:t?.whatsappNumber??""})))},[n,x]),i.useEffect(()=>{n&&d&&d.length===2?q(d):(b([]),d||h("city",""))},[n,d,h]);const J=async()=>{try{C(!0);const t=await fetch("https://servicodados.ibge.gov.br/api/v1/localidades/estados?orderBy=nome");if(t.ok){const r=await t.json();S(r)}else S($)}catch{S($)}finally{C(!1)}},q=async t=>{try{F(!0);const r=await fetch(`https://servicodados.ibge.gov.br/api/v1/localidades/estados/${t}/municipios`);if(r.ok){const R=(await r.json()).sort((o,p)=>o.nome.localeCompare(p.nome));b(R)}else b([])}catch{b([])}finally{F(!1)}},v=()=>{s(),x(),y(null),f(null)},Q=async t=>{I(!0),f(null),y(null);const r=t.cpf.replace(/\D/g,""),M=t.whatsappNumber.replace(/\D/g,""),R=t.participantType==="PRODUTOR"?parseFloat((t.hectares??"").replace(",",".")):void 0;try{const o=await X(`/courses/${u}/enroll`,{method:"POST",auth:!0,body:JSON.stringify({cpf:r,birthDate:t.birthDate,participantType:t.participantType,hectares:t.participantType==="PRODUTOR"?R:void 0,state:t.state,city:t.city,whatsappNumber:M})}),p=o.enrollment?.status,j=o.metadata?.waitlistPosition??null;let N="Inscrição realizada com sucesso!";p==="WAITLIST"?N=j&&j>0?`Você entrou na lista de espera deste curso. Sua posição atual é ${j}.`:"Você entrou na lista de espera deste curso. Aguarde a aprovação do administrador.":p==="PENDING_REGION"?N=o.enrollment?.eligibilityReason||"Seu cadastro foi recebido, mas ainda não está elegível para participar deste curso.":p==="REJECTED"&&(N=o.enrollment?.eligibilityReason||"Sua inscrição foi registrada, mas não pôde ser aprovada."),y({status:p??"CONFIRMED",message:N,waitlistPosition:j}),x({name:"",email:"",password:"",cpf:"",birthDate:"",participantType:"ESTUDANTE",hectares:"",state:"",city:"",whatsappNumber:""}),g?.({enrollment:o.enrollment,metadata:o.metadata})}catch(o){f(o instanceof Error?o.message:"Erro ao processar inscrição"),W(!1)}finally{I(!1)}};return n?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4",children:e.jsxs("div",{className:"flex max-h-[90vh] w-full max-w-2xl flex-col overflow-hidden rounded-lg bg-white shadow-xl",children:[e.jsxs("div",{className:"sticky top-0 flex items-center justify-between border-b bg-white px-6 py-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-[#003366]",children:"Inscrever-se no Curso"}),e.jsx("button",{onClick:v,className:"text-gray-400 transition-colors hover:text-gray-600",type:"button",children:e.jsx("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-6 py-6",children:[e.jsxs("p",{className:"mb-6 text-gray-600",children:["Curso:"," ",e.jsx("span",{className:"font-semibold text-[#003366]",children:k})]}),m&&e.jsx("div",{className:`mb-6 rounded-lg border px-4 py-3 text-sm ${m.status==="CONFIRMED"?"border-green-200 bg-green-50 text-green-800":m.status==="WAITLIST"?"border-yellow-200 bg-yellow-50 text-yellow-800":"border-blue-200 bg-blue-50 text-blue-800"}`,children:m.message}),O&&e.jsx("div",{className:"mb-6 rounded-lg border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-700",children:O}),!m&&e.jsxs("form",{onSubmit:L(Q),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"CPF *"}),e.jsx("input",{...c("cpf"),type:"text",maxLength:14,inputMode:"numeric",placeholder:"000.000.000-00",className:"w-full rounded-md border border-gray-300 px-4 py-2 text-gray-900 focus:border-transparent focus:ring-2 focus:ring-[#FF6600]",onChange:t=>{const r=t.target.value.replace(/\D/g,"").slice(0,11);h("cpf",r,{shouldValidate:!0}),t.target.value=se(r)}}),a.cpf&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:a.cpf.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Data de Nascimento *"}),e.jsx("input",{...c("birthDate"),type:"date",max:new Date().toISOString().split("T")[0],className:"w-full rounded-md border border-gray-300 px-4 py-2 text-gray-900 focus:border-transparent focus:ring-2 focus:ring-[#FF6600]"}),a.birthDate&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:a.birthDate.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"WhatsApp (com DDD) *"}),e.jsx("input",{...c("whatsappNumber"),type:"tel",inputMode:"tel",placeholder:"(00) 00000-0000",className:"w-full rounded-md border border-gray-300 px-4 py-2 text-gray-900 focus:border-transparent focus:ring-2 focus:ring-[#FF6600]",onChange:t=>{const r=t.target.value.replace(/\D/g,"").slice(0,11);h("whatsappNumber",r,{shouldValidate:!0}),t.target.value=ae(r)}}),a.whatsappNumber&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:a.whatsappNumber.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700 md:text-base",children:"Você é: *"}),e.jsxs("select",{...c("participantType"),className:"w-full rounded-md border border-gray-300 px-4 py-3 text-base text-gray-900 focus:border-transparent focus:ring-2 focus:ring-[#FF6600] md:py-2 md:text-sm appearance-none bg-white cursor-pointer min-h-[48px] touch-manipulation",style:{backgroundImage:`url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e")`,backgroundPosition:"right 0.75rem center",backgroundRepeat:"no-repeat",backgroundSize:"1.5em 1.5em",paddingRight:"2.5rem"},children:[e.jsx("option",{value:"",children:"Selecione..."}),e.jsx("option",{value:"ESTUDANTE",children:"Estudante"}),e.jsx("option",{value:"PROFESSOR",children:"Professor"}),e.jsx("option",{value:"PESQUISADOR",children:"Pesquisador"}),e.jsx("option",{value:"PRODUTOR",children:"Produtor"})]}),a.participantType&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:a.participantType.message})]}),B==="PRODUTOR"&&e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Quantos hectares você possui? *"}),e.jsx("input",{...c("hectares"),type:"number",step:"0.01",min:"0",placeholder:"Ex: 10.5",className:"w-full rounded-md border border-gray-300 px-4 py-2 text-gray-900 focus:border-transparent focus:ring-2 focus:ring-[#FF6600]"}),a.hectares&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:a.hectares.message})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700 md:text-base",children:"Estado *"}),e.jsxs("select",{...c("state"),disabled:T,className:"w-full rounded-md border border-gray-300 px-4 py-3 text-base text-gray-900 focus:border-transparent focus:ring-2 focus:ring-[#FF6600] disabled:opacity-50 md:py-2 md:text-sm appearance-none bg-white cursor-pointer min-h-[48px] touch-manipulation",style:{backgroundImage:`url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e")`,backgroundPosition:"right 0.75rem center",backgroundRepeat:"no-repeat",backgroundSize:"1.5em 1.5em",paddingRight:"2.5rem"},children:[e.jsx("option",{value:"",children:T?"Carregando estados...":"Selecione o estado..."}),G.map(t=>e.jsx("option",{value:t.sigla,children:t.nome},t.sigla))]}),a.state&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:a.state.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700 md:text-base",children:"Cidade *"}),e.jsxs("select",{...c("city"),disabled:!d||P,className:"w-full rounded-md border border-gray-300 px-4 py-3 text-base text-gray-900 focus:border-transparent focus:ring-2 focus:ring-[#FF6600] disabled:opacity-50 md:py-2 md:text-sm appearance-none bg-white cursor-pointer min-h-[48px] touch-manipulation",style:{backgroundImage:`url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e")`,backgroundPosition:"right 0.75rem center",backgroundRepeat:"no-repeat",backgroundSize:"1.5em 1.5em",paddingRight:"2.5rem"},children:[e.jsx("option",{value:"",children:P?"Carregando cidades...":d?"Selecione a cidade...":"Selecione o estado primeiro"}),V.map(t=>e.jsx("option",{value:t.nome,children:t.nome},t.nome))]}),a.city&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:a.city.message})]})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:v,className:"flex-1 rounded-md border border-gray-300 px-6 py-3 font-semibold text-gray-700 transition-colors hover:bg-gray-50",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:A,className:"flex-1 rounded-md bg-[#FF6600] px-6 py-3 font-semibold text-white transition-colors hover:bg-[#e55a00] disabled:cursor-not-allowed disabled:opacity-50",children:A?z?"Cadastrando...":"Enviando...":"Confirmar Inscrição"})]})]})]}),m&&e.jsx("div",{className:"border-t bg-gray-50 px-6 py-4",children:e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Revise suas notificações para acompanhar o status da inscrição."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:v,className:"rounded-md border border-gray-300 px-4 py-2 text-sm font-semibold text-gray-700 transition-colors hover:bg-gray-100",children:"Fechar"}),e.jsx("button",{type:"button",onClick:v,className:"rounded-md bg-[#FF6600] px-4 py-2 text-sm font-semibold text-white transition-colors hover:bg-[#e55a00]",children:"Entendi"})]})]})})]})}):null}export{ce as C};
