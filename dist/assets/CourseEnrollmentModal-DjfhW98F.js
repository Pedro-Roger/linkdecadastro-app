import{j as e}from"./index-CKd_6dCy.js";import{d as l}from"./react-vendor-40RSlyA9.js";import{o as H,u as K,Z as T,s as c,e as X}from"./form-vendor-UKDbifrO.js";import{t as Y}from"./zod-Bd6eNPbn.js";import{a as B}from"./api-WS8dxZuR.js";import{u as ee}from"./useAuth-Dhb34Y_Y.js";const te=["ESTUDANTE","PROFESSOR","PESQUISADOR","PRODUTOR"],se=H({name:c().min(1,"Nome é obrigatório").optional(),email:c().email("Email inválido").optional(),password:c().min(6,"Senha deve ter no mínimo 6 caracteres").optional(),cpf:c().min(11,"CPF deve ter 11 dígitos"),birthDate:c().min(1,"Data de nascimento é obrigatória"),participantType:X(te,{required_error:"Selecione o tipo de participante"}),hectares:c().optional(),state:c().min(2,"Estado é obrigatório"),city:c().min(1,"Cidade é obrigatória"),whatsappNumber:c().min(10,"Informe o WhatsApp com DDD")}),ae=i=>se.superRefine((a,b)=>{a.cpf.replace(/\D/g,"").length!==11&&b.addIssue({code:T.custom,message:"CPF deve ter 11 dígitos",path:["cpf"]});const v=a.whatsappNumber.replace(/\D/g,"");if((v.length<10||v.length>11)&&b.addIssue({code:T.custom,message:"Informe um número de WhatsApp válido (com DDD)",path:["whatsappNumber"]}),a.participantType==="PRODUTOR"){const R=parseFloat(a.hectares??"");(Number.isNaN(R)||R<=0)&&b.addIssue({code:T.custom,message:"Hectares é obrigatório para produtores e deve ser maior que zero",path:["hectares"]})}}),G=[{sigla:"AC",nome:"Acre"},{sigla:"AL",nome:"Alagoas"},{sigla:"AP",nome:"Amapá"},{sigla:"AM",nome:"Amazonas"},{sigla:"BA",nome:"Bahia"},{sigla:"CE",nome:"Ceará"},{sigla:"DF",nome:"Distrito Federal"},{sigla:"ES",nome:"Espírito Santo"},{sigla:"GO",nome:"Goiás"},{sigla:"MA",nome:"Maranhão"},{sigla:"MT",nome:"Mato Grosso"},{sigla:"MS",nome:"Mato Grosso do Sul"},{sigla:"MG",nome:"Minas Gerais"},{sigla:"PA",nome:"Pará"},{sigla:"PB",nome:"Paraíba"},{sigla:"PR",nome:"Paraná"},{sigla:"PE",nome:"Pernambuco"},{sigla:"PI",nome:"Piauí"},{sigla:"RJ",nome:"Rio de Janeiro"},{sigla:"RN",nome:"Rio Grande do Norte"},{sigla:"RS",nome:"Rio Grande do Sul"},{sigla:"RO",nome:"Rondônia"},{sigla:"RR",nome:"Roraima"},{sigla:"SC",nome:"Santa Catarina"},{sigla:"SP",nome:"São Paulo"},{sigla:"SE",nome:"Sergipe"},{sigla:"TO",nome:"Tocantins"}];function re(i){return i.replace(/\D/g,"").slice(0,11).replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d{1,2})$/,"$1-$2")}function oe(i){const a=i.replace(/\D/g,"").slice(0,11);return a.length<=2?a:a.length<=6?`(${a.slice(0,2)}) ${a.slice(2)}`:a.length<=10?`(${a.slice(0,2)}) ${a.slice(2,6)}-${a.slice(6)}`:`(${a.slice(0,2)}) ${a.slice(2,7)}-${a.slice(7)}`}function pe({isOpen:i,onClose:a,courseId:b,courseTitle:P,onSuccess:v}){const{user:d}=ee(),V=l.useMemo(()=>ae(),[!1]),{register:m,handleSubmit:z,watch:C,setValue:w,reset:g,formState:{errors:r}}=K({resolver:Y(V),defaultValues:{name:"",email:"",state:"",city:"",whatsappNumber:""},shouldUnregister:!0}),p=C("state"),W=C("participantType"),[J,k]=l.useState([]),[q,N]=l.useState([]),[F,A]=l.useState(!1),[I,O]=l.useState(!1),[M,$]=l.useState(!1),[Q,_]=l.useState(!1),[U,f]=l.useState(null),[h,y]=l.useState(null);l.useEffect(()=>{i&&d?(L(),y(null),f(null),(async()=>{try{const s=await B("/user/profile",{auth:!0}),o={};s.phone&&(o.whatsappNumber=s.phone),s.state&&(o.state=s.state,E(s.state)),s.city&&(o.city=s.city),s.participantType&&(o.participantType=s.participantType),s.hectares&&(o.hectares=String(s.hectares)),g(u=>({...u,...o}))}catch(s){console.error("Erro ao buscar perfil do usuário:",s);const o={whatsappNumber:d?.phone||""};d?.state&&(o.state=d.state,E(d.state)),d?.city&&(o.city=d.city),g(u=>({...u,...o}))}})()):i&&(L(),y(null),f(null),g(t=>({...t,whatsappNumber:""})))},[i,g,d]),l.useEffect(()=>{i&&p&&p.length===2?E(p):(N([]),p||w("city",""))},[i,p,w]);const L=async()=>{try{A(!0);const t=await fetch("https://servicodados.ibge.gov.br/api/v1/localidades/estados?orderBy=nome");if(t.ok){const s=await t.json();k(s)}else k(G)}catch{k(G)}finally{A(!1)}},E=async t=>{try{O(!0);const s=await fetch(`https://servicodados.ibge.gov.br/api/v1/localidades/estados/${t}/municipios`);if(s.ok){const u=(await s.json()).sort((n,x)=>n.nome.localeCompare(x.nome));N(u)}else N([])}catch{N([])}finally{O(!1)}},j=()=>{a(),g(),y(null),f(null)},Z=async t=>{$(!0),f(null),y(null);const s=t.cpf.replace(/\D/g,""),o=t.whatsappNumber.replace(/\D/g,""),u=t.participantType==="PRODUTOR"?parseFloat((t.hectares??"").replace(",",".")):void 0;try{const n=await B(`/courses/${b}/enroll`,{method:"POST",auth:!0,body:JSON.stringify({cpf:s,birthDate:t.birthDate,participantType:t.participantType,hectares:t.participantType==="PRODUTOR"?u:void 0,state:t.state,city:t.city,whatsappNumber:o})}),x=n.enrollment?.status,S=n.metadata?.waitlistPosition??null;let D="Inscrição realizada com sucesso!";x==="WAITLIST"?D=S&&S>0?`Você entrou na lista de espera deste curso. Sua posição atual é ${S}.`:"Você entrou na lista de espera deste curso. Aguarde a aprovação do administrador.":x==="PENDING_REGION"?D=n.enrollment?.eligibilityReason||"Seu cadastro foi recebido, mas ainda não está elegível para participar deste curso.":x==="REJECTED"&&(D=n.enrollment?.eligibilityReason||"Sua inscrição foi registrada, mas não pôde ser aprovada."),y({status:x??"CONFIRMED",message:D,waitlistPosition:S}),g({name:"",email:"",password:"",cpf:"",birthDate:"",participantType:"ESTUDANTE",hectares:"",state:"",city:"",whatsappNumber:""}),v?.({enrollment:n.enrollment,metadata:n.metadata})}catch(n){f(n instanceof Error?n.message:"Erro ao processar inscrição"),_(!1)}finally{$(!1)}};return i?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4",children:e.jsxs("div",{className:"flex max-h-[90vh] w-full max-w-2xl flex-col overflow-hidden rounded-lg bg-white shadow-xl",children:[e.jsxs("div",{className:"sticky top-0 flex items-center justify-between border-b bg-white px-6 py-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-[#003366]",children:"Inscrever-se no Curso"}),e.jsx("button",{onClick:j,className:"text-gray-400 transition-colors hover:text-gray-600",type:"button",children:e.jsx("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-6 py-6",children:[e.jsxs("p",{className:"mb-6 text-gray-600",children:["Curso:"," ",e.jsx("span",{className:"font-semibold text-[#003366]",children:P})]}),h&&e.jsx("div",{className:`mb-6 rounded-lg border px-4 py-3 text-sm ${h.status==="CONFIRMED"?"border-green-200 bg-green-50 text-green-800":h.status==="WAITLIST"?"border-yellow-200 bg-yellow-50 text-yellow-800":"border-blue-200 bg-blue-50 text-blue-800"}`,children:h.message}),U&&e.jsx("div",{className:"mb-6 rounded-lg border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-700",children:U}),!h&&e.jsxs("form",{onSubmit:z(Z),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"CPF *"}),e.jsx("input",{...m("cpf"),type:"text",maxLength:14,inputMode:"numeric",placeholder:"000.000.000-00",className:"w-full rounded-md border border-gray-300 px-4 py-2 text-gray-900 focus:border-transparent focus:ring-2 focus:ring-[#FF6600]",onChange:t=>{const s=t.target.value.replace(/\D/g,"").slice(0,11);w("cpf",s,{shouldValidate:!0}),t.target.value=re(s)}}),r.cpf&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:r.cpf.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Data de Nascimento *"}),e.jsx("input",{...m("birthDate"),type:"date",max:new Date().toISOString().split("T")[0],className:"w-full rounded-md border border-gray-300 px-4 py-2 text-gray-900 focus:border-transparent focus:ring-2 focus:ring-[#FF6600]"}),r.birthDate&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:r.birthDate.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"WhatsApp (com DDD) *"}),e.jsx("input",{...m("whatsappNumber"),type:"tel",inputMode:"tel",placeholder:"(00) 00000-0000",className:"w-full rounded-md border border-gray-300 px-4 py-2 text-gray-900 focus:border-transparent focus:ring-2 focus:ring-[#FF6600]",onChange:t=>{const s=t.target.value.replace(/\D/g,"").slice(0,11);w("whatsappNumber",s,{shouldValidate:!0}),t.target.value=oe(s)}}),r.whatsappNumber&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:r.whatsappNumber.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700 md:text-base",children:"Você é: *"}),e.jsxs("select",{...m("participantType"),className:"w-full rounded-md border border-gray-300 px-4 py-3 text-base text-gray-900 focus:border-transparent focus:ring-2 focus:ring-[#FF6600] md:py-2 md:text-sm appearance-none bg-white cursor-pointer min-h-[48px] touch-manipulation",style:{backgroundImage:`url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e")`,backgroundPosition:"right 0.75rem center",backgroundRepeat:"no-repeat",backgroundSize:"1.5em 1.5em",paddingRight:"2.5rem"},children:[e.jsx("option",{value:"",children:"Selecione..."}),e.jsx("option",{value:"ESTUDANTE",children:"Estudante"}),e.jsx("option",{value:"PROFESSOR",children:"Professor"}),e.jsx("option",{value:"PESQUISADOR",children:"Pesquisador"}),e.jsx("option",{value:"PRODUTOR",children:"Produtor"})]}),r.participantType&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:r.participantType.message})]}),W==="PRODUTOR"&&e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Quantos hectares você possui? *"}),e.jsx("input",{...m("hectares"),type:"number",step:"0.01",min:"0",placeholder:"Ex: 10.5",className:"w-full rounded-md border border-gray-300 px-4 py-2 text-gray-900 focus:border-transparent focus:ring-2 focus:ring-[#FF6600]"}),r.hectares&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:r.hectares.message})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700 md:text-base",children:"Estado *"}),e.jsxs("select",{...m("state"),disabled:F,className:"w-full rounded-md border border-gray-300 px-4 py-3 text-base text-gray-900 focus:border-transparent focus:ring-2 focus:ring-[#FF6600] disabled:opacity-50 md:py-2 md:text-sm appearance-none bg-white cursor-pointer min-h-[48px] touch-manipulation",style:{backgroundImage:`url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e")`,backgroundPosition:"right 0.75rem center",backgroundRepeat:"no-repeat",backgroundSize:"1.5em 1.5em",paddingRight:"2.5rem"},children:[e.jsx("option",{value:"",children:F?"Carregando estados...":"Selecione o estado..."}),J.map(t=>e.jsx("option",{value:t.sigla,children:t.nome},t.sigla))]}),r.state&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:r.state.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700 md:text-base",children:"Cidade *"}),e.jsxs("select",{...m("city"),disabled:!p||I,className:"w-full rounded-md border border-gray-300 px-4 py-3 text-base text-gray-900 focus:border-transparent focus:ring-2 focus:ring-[#FF6600] disabled:opacity-50 md:py-2 md:text-sm appearance-none bg-white cursor-pointer min-h-[48px] touch-manipulation",style:{backgroundImage:`url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e")`,backgroundPosition:"right 0.75rem center",backgroundRepeat:"no-repeat",backgroundSize:"1.5em 1.5em",paddingRight:"2.5rem"},children:[e.jsx("option",{value:"",children:I?"Carregando cidades...":p?"Selecione a cidade...":"Selecione o estado primeiro"}),q.map(t=>e.jsx("option",{value:t.nome,children:t.nome},t.nome))]}),r.city&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:r.city.message})]})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:j,className:"flex-1 rounded-md border border-gray-300 px-6 py-3 font-semibold text-gray-700 transition-colors hover:bg-gray-50",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:M,className:"flex-1 rounded-md bg-[#FF6600] px-6 py-3 font-semibold text-white transition-colors hover:bg-[#e55a00] disabled:cursor-not-allowed disabled:opacity-50",children:M?Q?"Cadastrando...":"Enviando...":"Confirmar Inscrição"})]})]})]}),h&&e.jsx("div",{className:"border-t bg-gray-50 px-6 py-4",children:e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Revise suas notificações para acompanhar o status da inscrição."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:j,className:"rounded-md border border-gray-300 px-4 py-2 text-sm font-semibold text-gray-700 transition-colors hover:bg-gray-100",children:"Fechar"}),e.jsx("button",{type:"button",onClick:j,className:"rounded-md bg-[#FF6600] px-4 py-2 text-sm font-semibold text-white transition-colors hover:bg-[#e55a00]",children:"Entendi"})]})]})})]})}):null}export{pe as C};
