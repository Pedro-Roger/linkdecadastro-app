import{u as I,j as e}from"./index-CsxD5A8A.js";import{u as S,h as T,d as l}from"./react-vendor-40RSlyA9.js";import{F as A}from"./Footer-Cs2AOzBe.js";import{M as L}from"./MobileNavbar-Df5BYSkg.js";import{C as M}from"./CourseEnrollmentModal-BmCpeJRn.js";import{a as $,n as P}from"./api-cc_Vofyw.js";import{f as O}from"./utils-vendor-DwAQI6Fw.js";import{p as V}from"./NotificationBell-ZfODFpwn.js";import"./ui-vendor-VWVTWWFz.js";import"./form-vendor-UKDbifrO.js";import"./zod-Bd6eNPbn.js";function Q(){const N=S(),[f]=T(),{isAuthenticated:p}=I(),[j,D]=l.useState([]),[i,F]=l.useState([]),[x,v]=l.useState(!0),[m,C]=l.useState(""),[o,d]=l.useState("all"),[h,b]=l.useState({isOpen:!1,courseId:"",courseTitle:""}),[u,c]=l.useState(null);l.useEffect(()=>{y()},[]),l.useEffect(()=>{const t=f.get("enroll");if(t&&i.length>0&&!x){const s=i.find(a=>a.slug===t||a.id===t);s&&setTimeout(()=>{b({isOpen:!0,courseId:s.id,courseTitle:s.title}),window.history.replaceState({},"","/")},800)}},[f,i,x]);const w=l.useCallback(()=>{let t=[...i];if(o!=="all"){const s=new Date;t=t.filter(a=>{const n=a.startDate?new Date(a.startDate):null,r=a.endDate?new Date(a.endDate):null;switch(o){case"featured":return!n||n>s;case"available":return!n||n>=s||n<=s&&(!r||r>=s);case"ongoing":return n&&n<=s&&(!r||r>=s);case"closed":return r&&r<s;default:return!0}})}if(m){const s=m.toLowerCase();t=t.filter(a=>a.title.toLowerCase().includes(s)||a.description?.toLowerCase().includes(s)||a.creator.name.toLowerCase().includes(s))}D(t)},[o,m,i]);l.useEffect(()=>{w()},[w]);const y=async()=>{try{v(!0);const t=await $("/courses");F(t)}catch{}finally{v(!1)}},E=t=>{if(y(),t?.enrollment){const s=t.enrollment.status;if(s==="WAITLIST"){const a=t.metadata?.waitlistPosition;c({message:a&&a>0?`Você entrou na lista de espera. Posição atual: ${a}.`:"Você entrou na lista de espera deste curso. Aguarde a aprovação do administrador.",tone:"info"})}else c(s==="PENDING_REGION"?{message:t.enrollment.eligibilityReason||"Cadastro registrado, aguardando confirmação da equipe.",tone:"warning"}:s==="REJECTED"?{message:t.enrollment.eligibilityReason||"Sua inscrição foi registrada, mas não pôde ser aprovada automaticamente.",tone:"warning"}:{message:'Inscrição confirmada! Você já pode acessar o conteúdo em "Meus Cursos".',tone:"success"})}else c({message:"Solicitação enviada. Verifique seus cursos em alguns instantes.",tone:"info"});setTimeout(()=>c(null),8e3)},k=t=>{const s=new Date,a=t.startDate?new Date(t.startDate):null,n=t.endDate?new Date(t.endDate):null;return n&&n<s?{label:"Encerrado",color:"bg-gray-500",badge:"Encerrado"}:a?a>s?{label:"Inscrições Abertas",color:"bg-green-500",badge:"Inscrições Abertas"}:a<=s&&(!n||n>=s)?{label:"Em Andamento",color:"bg-blue-500",badge:"Em Andamento"}:{label:"Disponível",color:"bg-green-500",badge:"Inscrições Abertas"}:{label:"Inscrições Abertas",color:"bg-green-500",badge:"Inscrições Abertas"}},g=t=>{const s=new Date;return i.filter(a=>{const n=a.startDate?new Date(a.startDate):null,r=a.endDate?new Date(a.endDate):null;switch(t){case"featured":return!n||n>s;case"available":return!n||n>=s||n<=s&&(!r||r>=s);case"ongoing":return n&&n<=s&&(!r||r>=s);case"closed":return r&&r<s;default:return!0}}).length};return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col pb-20 md:pb-0",children:[e.jsx(L,{}),e.jsx("div",{className:"bg-white border-b",children:e.jsxs("div",{className:"container mx-auto px-4 py-6 space-y-4",children:[u&&e.jsx("div",{className:`rounded-lg border px-4 py-3 text-sm ${u.tone==="success"?"border-green-200 bg-green-50 text-green-800":u.tone==="warning"?"border-yellow-200 bg-yellow-50 text-yellow-800":"border-blue-200 bg-blue-50 text-blue-800"}`,children:u.message}),e.jsxs("div",{className:"relative max-w-2xl mx-auto",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{className:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",placeholder:"Pesquisar cursos por nome, descrição ou local...",value:m,onChange:t=>C(t.target.value),className:"block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#FF6600] focus:border-transparent text-gray-900"})]})]})}),e.jsx("div",{className:"bg-white border-b",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex flex-wrap gap-3 justify-center",children:[e.jsxs("button",{onClick:()=>d("all"),className:`px-4 py-2 rounded-full font-medium transition-colors ${o==="all"?"bg-[#FF6600] text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Todos os Cursos (",i.length,")"]}),e.jsxs("button",{onClick:()=>d("featured"),className:`px-4 py-2 rounded-full font-medium transition-colors ${o==="featured"?"bg-[#FF6600] text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Em Destaque (",g("featured"),")"]}),e.jsxs("button",{onClick:()=>d("available"),className:`px-4 py-2 rounded-full font-medium transition-colors ${o==="available"?"bg-[#FF6600] text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Disponíveis (",g("available"),")"]}),e.jsxs("button",{onClick:()=>d("ongoing"),className:`px-4 py-2 rounded-full font-medium transition-colors ${o==="ongoing"?"bg-[#FF6600] text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Em Andamento (",g("ongoing"),")"]}),e.jsxs("button",{onClick:()=>d("closed"),className:`px-4 py-2 rounded-full font-medium transition-colors ${o==="closed"?"bg-[#FF6600] text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Encerrados (",g("closed"),")"]})]})})}),e.jsx("div",{className:"container mx-auto px-4 py-8 flex-1",children:x?e.jsx("div",{className:"text-center py-24",children:e.jsx("div",{className:"text-xl text-gray-600",children:"Carregando cursos..."})}):j.length===0?e.jsxs("div",{className:"text-center py-24",children:[e.jsx("p",{className:"text-gray-500 text-lg mb-4",children:"Nenhum curso encontrado."}),e.jsx("p",{className:"text-gray-400",children:"Tente ajustar os filtros ou a busca."})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:j.map(t=>{const s=k(t),a=!t.startDate||new Date(t.startDate)>new Date,n=t.maxEnrollments&&t._count.enrollments>0?Math.min(100,t._count.enrollments/t.maxEnrollments*100):(t._count.enrollments>0,0);return e.jsxs("div",{className:"relative bg-white rounded-lg shadow-md overflow-hidden hover:shadow-xl transition-shadow",children:[t.bannerUrl&&t.bannerUrl.trim()?e.jsxs("div",{className:"relative w-full h-[386px] overflow-hidden bg-gray-200",children:[e.jsx("img",{src:P(t.bannerUrl),alt:`Banner do curso ${t.title}`,className:"w-full h-full min-w-full min-h-full object-cover",style:{objectFit:"cover",objectPosition:"center"},onError:r=>{r.currentTarget.style.display="none"}}),e.jsx("div",{className:`absolute top-0 left-0 right-0 h-2 ${a?"bg-[#FF6600]":"bg-[#003366]"}`}),a&&e.jsx("div",{className:"absolute top-3 right-3 bg-[#FF6600] text-white text-xs px-2 py-1 rounded-full font-semibold shadow-lg",children:"Destaque"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`h-2 ${a?"bg-[#FF6600]":"bg-[#003366]"}`}),a&&e.jsx("div",{className:"absolute top-2 right-2 bg-[#FF6600] text-white text-xs px-2 py-1 rounded-full font-semibold",children:"Destaque"})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-3",children:e.jsx("span",{className:`${s.color} text-white text-xs px-2 py-1 rounded-full font-medium`,children:s.badge})}),e.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-2 line-clamp-2",children:t.title}),t.description&&e.jsx("p",{className:"text-gray-600 text-sm mb-4 line-clamp-3",children:t.description}),e.jsxs("div",{className:"space-y-2 mb-4 text-sm text-gray-600",children:[t.startDate&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("span",{children:O(new Date(t.startDate),"dd/MM/yyyy",{locale:V})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),e.jsx("span",{children:"Online"})]}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("span",{className:"text-gray-500",children:[t._count.enrollments,t.maxEnrollments?`/${t.maxEnrollments}`:""," vagas ",t.maxEnrollments?"ocupadas":"inscritos"]})}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-[#FF6600] h-2 rounded-full transition-all",style:{width:`${n}%`}})})]}),e.jsx("button",{onClick:()=>{p?b({isOpen:!0,courseId:t.id,courseTitle:t.title}):N("/login")},className:"block w-full bg-[#FF6600] text-white text-center py-3 rounded-md font-semibold hover:bg-[#e55a00] transition-colors",children:"Cadastrar-se no Curso"})]})]},t.id)})})}),e.jsx(A,{}),p&&e.jsx("div",{className:"md:hidden h-20"}),e.jsx(M,{isOpen:h.isOpen,onClose:()=>b({isOpen:!1,courseId:"",courseTitle:""}),courseId:h.courseId,courseTitle:h.courseTitle,onSuccess:E})]})}export{Q as default};
