import{u as fe,j as e,L as be}from"./index-DHiB8Icf.js";import{u as ve,d as a,L as J}from"./react-vendor-40RSlyA9.js";import{M as ye}from"./MobileNavbar-DcONV8u5.js";import{F as je}from"./Footer-CwOlXCR5.js";import{a as y}from"./api-cc_Vofyw.js";import"./ui-vendor-VWVTWWFz.js";import"./NotificationBell-BFHzVvAE.js";import"./utils-vendor-DwAQI6Fw.js";function Re(){const R=ve(),{user:j,loading:b,isAuthenticated:x,signOut:G}=fe({requireAuth:!0,redirectTo:"/login"}),[T,K]=a.useState([]),[u,X]=a.useState([]),[w,P]=a.useState(!0),[$,k]=a.useState(!1),[D,L]=a.useState(!1),[n,ee]=a.useState(null),[f,v]=a.useState(""),[m,C]=a.useState(""),[d,te]=a.useState(""),[i,se]=a.useState(""),[M,g]=a.useState(null),[q,W]=a.useState(null),[z,ae]=a.useState([]),[U,re]=a.useState([]),[N,oe]=a.useState("course"),[r,E]=a.useState(null),[o,A]=a.useState(null),[ne,ie]=a.useState([]),[_,F]=a.useState([]),[I,Q]=a.useState(!1),[B,Y]=a.useState(!1),V=a.useMemo(()=>n?n.qrCodeBase64?n.qrCodeBase64:n.qrCode?`https://api.qrserver.com/v1/create-qr-code/?size=220x220&data=${encodeURIComponent(n.qrCode)}`:null:null,[n]);a.useEffect(()=>{b||(!x||j?.role!=="ADMIN"?R("/my-courses"):(de(),ue(),Z(!0),O()))},[b,x,j,R]),a.useEffect(()=>{le()},[]),a.useEffect(()=>{if(!i){F([]),C("");return}C(""),ce(i)},[i]),a.useEffect(()=>{!x||b||w&&!i&&!m&&!d||Z()},[i,m,d,x,b,w]),a.useEffect(()=>{if(!x)return;const t=setInterval(()=>{O()},1e4);return()=>clearInterval(t)},[x]),a.useEffect(()=>{r||o?me():v("")},[r,o]),a.useEffect(()=>{let t=T;m&&(t=t.filter(s=>s.cidade?.toLowerCase().includes(m.toLowerCase()))),i&&(t=t.filter(s=>s.estado?.toLowerCase().includes(i.toLowerCase()))),d&&(d==="PRODUTOR"?t=t.filter(s=>s.produtor):d==="PROFESSOR"?t=t.filter(s=>s.professor):d==="ESTUDANTE"&&(t=t.filter(s=>s.estudante))),X(t)},[T,m,i,d]);async function le(){try{Q(!0);const t=await fetch("https://servicodados.ibge.gov.br/api/v1/localidades/estados?orderBy=nome");if(!t.ok)throw new Error("Erro ao carregar estados");const l=(await t.json()||[]).map(c=>({sigla:c.sigla,nome:c.nome})).sort((c,p)=>c.nome.localeCompare(p.nome));ie(l)}catch(t){console.error("Erro ao carregar estados:",t)}finally{Q(!1)}}async function ce(t){try{Y(!0);const s=await fetch(`https://servicodados.ibge.gov.br/api/v1/localidades/estados/${t}/municipios`);if(!s.ok)throw new Error("Erro ao carregar cidades");const c=(await s.json()||[]).map(p=>p.nome).sort((p,S)=>p.localeCompare(S));F(c)}catch(s){console.error("Erro ao carregar cidades:",s),F([])}finally{Y(!1)}}async function de(){try{const t=await y("/admin/courses",{auth:!0});ae(t||[])}catch{}}async function ue(){try{const t=await y("/events",{auth:!0});re(t||[])}catch{}}async function Z(t=!1){try{t?P(!0):k(!0);const s=new URLSearchParams;m&&s.append("city",m),i&&s.append("state",i),d&&s.append("participantType",d);const l=await y(`/admin/courses/enrollments/whatsapp?${s.toString()}`,{auth:!0});K(l.participantes||[])}catch{g("Erro ao carregar participantes")}finally{t?P(!1):k(!1)}}function me(){if(!r&&!o){v("");return}const t=typeof window<"u"?window.location.origin:"";let s="",l="";const c=r?"curso":"evento";r?(l=r.title,r.slug?s=`${t}/c/${r.slug}`:s=`${t}/course/${r.id}`):o&&(l=o.title,o.slug?s=`${t}/register-event.html?event=${o.slug}`:s=`${t}/register-event.html?event=${o.id}`);const p=`Ol√°, {nome}!

Participe j√° do nosso ${c}: *${l}*

Acreditamos que voc√™ vai se interessar! N√£o perca essa chance de participar.

Acesse o link abaixo para se inscrever:
${s}

Esperamos voc√™! üòä`;v(p)}function H(t){oe(t),E(null),A(null),v("")}function pe(t){const s=z.find(l=>l.id===t);E(s||null),A(null)}function xe(t){const s=U.find(l=>l.id===t);A(s||null),E(null)}async function O(){try{const t=await y("/api/whatsapp/status",{auth:!0});ee(t)}catch{console.error("Erro ao verificar status do WhatsApp")}}async function ge(){if(!f.trim()){g("Por favor, selecione um curso ou evento para compartilhar");return}if(!r&&!o){g("Por favor, selecione um curso ou evento para compartilhar");return}if(u.length===0){g("Nenhum participante selecionado ap√≥s aplicar os filtros");return}if(!n||n.status!=="READY"){g("WhatsApp n√£o est√° conectado. Verifique o status da conex√£o.");return}L(!0),g(null),W(null);try{const t=typeof window<"u"?window.location.origin:"";let s="",l="";r?(l=r.title,r.slug?s=`${t}/c/${r.slug}`:s=`${t}/course/${r.id}`):o&&(l=o.title,o.slug?s=`${t}/register-event.html?event=${o.slug}`:s=`${t}/register-event.html?event=${o.id}`);const c={};m&&(c.cidade=m),i&&(c.estado=i),d==="PRODUTOR"?c.produtor=!0:d==="PROFESSOR"?c.professor=!0:d==="ESTUDANTE"&&(c.estudante=!0);const p=u.map(h=>({id_contato:h.id_contato,nome:h.nome,cidade:h.cidade,estado:h.estado,produtor:h.produtor,professor:h.professor,estudante:h.estudante})),S=await y("/api/whatsapp/enviar-mensagem-segmentada",{method:"POST",auth:!0,body:JSON.stringify({mensagem:f,participantes:p,filtros:{}})});W(`Mensagem enviada com sucesso! ${S.enviadas||0} mensagens enviadas, ${S.falhas||0} falhas.`)}catch(t){g(t?.message||"Erro ao enviar mensagem")}finally{L(!1)}}if(b||w)return e.jsx(be,{});if(!x||j?.role!=="ADMIN")return null;const he={PRODUTOR:"Produtor",PROFESSOR:"Professor",ESTUDANTE:"Estudante"};return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col",children:[e.jsx(ye,{user:j,onSignOut:G}),e.jsx("main",{className:"flex-1",children:e.jsxs("div",{className:"container mx-auto px-4 py-8 pb-24 md:pb-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx(J,{to:"/admin/dashboard",className:"text-[#FF6600] hover:underline mb-4 inline-block",children:"‚Üê Voltar para Dashboard"}),e.jsx("h1",{className:"text-3xl font-bold text-[#003366] mb-2",children:"Enviar Mensagens WhatsApp"}),e.jsx("p",{className:"text-gray-600",children:"Selecione e filtre participantes para enviar mensagens segmentadas"})]}),n&&e.jsx("div",{className:`mb-6 p-4 rounded-lg ${n.status==="READY"?"bg-green-50 border border-green-200":n.status==="QR_CODE"?"bg-yellow-50 border border-yellow-200":"bg-red-50 border border-red-200"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-gray-900",children:["Status WhatsApp: ",n.status]}),n.status==="QR_CODE"&&e.jsxs("div",{className:"mt-3 space-y-3",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Escaneie o QR Code abaixo para conectar o WhatsApp Web."}),V&&e.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-4",children:[e.jsx("img",{src:V,alt:"QR Code WhatsApp",className:"w-48 h-48 bg-white p-3 rounded-lg shadow-md border"}),e.jsx("p",{className:"text-xs text-gray-500",children:'Caso o QR Code expire, clique em "Atualizar Status" para gerar um novo c√≥digo.'})]})]}),n.status==="READY"&&e.jsx("p",{className:"text-sm text-green-700 mt-1",children:"‚úì Conectado e pronto para enviar mensagens"}),n.status!=="READY"&&n.status!=="QR_CODE"&&e.jsx("p",{className:"text-sm text-red-700 mt-1",children:"‚úó WhatsApp n√£o est√° conectado"})]}),e.jsx("button",{onClick:O,className:"px-4 py-2 bg-[#FF6600] text-white rounded-md hover:bg-[#e55a00] transition-colors text-sm",children:"Atualizar Status"})]})}),M&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg text-red-700",children:M}),q&&e.jsx("div",{className:"mb-6 p-4 bg-green-50 border border-green-200 rounded-lg text-green-700",children:q}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-[#003366] mb-4",children:"Selecionar Curso ou Evento para Compartilhar"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipo"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{type:"button",onClick:()=>H("course"),className:`px-4 py-2 rounded-md font-medium transition-colors ${N==="course"?"bg-[#FF6600] text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Curso"}),e.jsx("button",{type:"button",onClick:()=>H("event"),className:`px-4 py-2 rounded-md font-medium transition-colors ${N==="event"?"bg-[#FF6600] text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Evento"})]})]}),N==="course"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Selecionar Curso"}),e.jsxs("select",{value:r?.id||"",onChange:t=>pe(t.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#FF6600] focus:border-transparent text-gray-900",children:[e.jsx("option",{value:"",children:"Selecione um curso..."}),z.map(t=>e.jsx("option",{value:t.id,children:t.title},t.id))]})]}),N==="event"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Selecionar Evento"}),e.jsxs("select",{value:o?.id||"",onChange:t=>xe(t.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#FF6600] focus:border-transparent text-gray-900",children:[e.jsx("option",{value:"",children:"Selecione um evento..."}),U.map(t=>e.jsx("option",{value:t.id,children:t.title},t.id))]})]}),(r||o)&&e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-md",children:[e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Selecionado:"})," ",(r||o)?.title]}),e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"A mensagem ser√° gerada automaticamente com sauda√ß√£o personalizada e o link abaixo"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-[#003366] mb-4",children:"Filtros"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Estado"}),e.jsxs("select",{value:i,onChange:t=>se(t.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#FF6600] focus:border-transparent text-gray-900",disabled:I,children:[e.jsx("option",{value:"",children:I?"Carregando estados...":"Todos os estados"}),ne.map(t=>e.jsx("option",{value:t.sigla,children:t.nome},t.sigla))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cidade"}),e.jsxs("select",{value:m,onChange:t=>C(t.target.value),disabled:!i||B||_.length===0,className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#FF6600] focus:border-transparent text-gray-900",children:[e.jsx("option",{value:"",children:i?B?"Carregando cidades...":"Todas as cidades":"Selecione um estado"}),_.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo de Participante"}),e.jsxs("select",{value:d,onChange:t=>te(t.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#FF6600] focus:border-transparent text-gray-900",children:[e.jsx("option",{value:"",children:"Todos os tipos"}),e.jsx("option",{value:"PRODUTOR",children:"Produtor"}),e.jsx("option",{value:"PROFESSOR",children:"Professor"}),e.jsx("option",{value:"ESTUDANTE",children:"Estudante"})]})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("strong",{children:u.length})," participantes encontrados ap√≥s aplicar os filtros"]}),$&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Atualizando lista de participantes..."})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-[#003366] mb-4",children:"Mensagem Autom√°tica"}),e.jsxs("div",{className:"mb-4 p-4 bg-gray-50 border border-gray-200 rounded-md",children:[e.jsxs("p",{className:"text-sm text-gray-700 mb-2",children:[e.jsx("strong",{children:"Como funciona:"})," A mensagem ser√° gerada automaticamente para cada participante com:"]}),e.jsxs("ul",{className:"text-sm text-gray-600 list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Sauda√ß√£o personalizada com o nome do participante"}),e.jsx("li",{children:"Texto convidativo sobre o curso/evento selecionado"}),e.jsx("li",{children:"Link direto para inscri√ß√£o"})]})]}),e.jsx("textarea",{value:f,onChange:t=>v(t.target.value),placeholder:r||o?"A mensagem ser√° gerada automaticamente...":"Selecione um curso ou evento acima para gerar a mensagem",rows:8,className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#FF6600] focus:border-transparent text-gray-900",readOnly:!r&&!o}),f&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("p",{className:"text-sm text-gray-500",children:[f.length," caracteres (mensagem ser√° personalizada para cada participante)"]}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:['* O nome "',"{nome}",'" ser√° substitu√≠do automaticamente pelo nome de cada participante']})]})]}),u.length===0&&!$&&e.jsx("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:e.jsx("p",{className:"text-gray-500 text-sm",children:"Nenhum participante encontrado com os filtros atuais. Ajuste os filtros e tente novamente."})}),u.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-[#003366] mb-4",children:["Participantes que receber√£o a mensagem (",u.length,")"]}),e.jsxs("div",{className:"max-h-96 overflow-y-auto",children:[e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Nome"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Telefone"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Cidade"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Tipo"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:u.slice(0,50).map((t,s)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:t.nome}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:t.telefone}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:t.cidade||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${t.produtor?"bg-green-100 text-green-800":t.professor?"bg-blue-100 text-blue-800":"bg-purple-100 text-purple-800"}`,children:he[t.participante_tipo]||t.participante_tipo})})]},t.id_contato))})]}),u.length>50&&e.jsxs("p",{className:"text-sm text-gray-500 mt-4 text-center",children:["Mostrando 50 de ",u.length," participantes"]})]})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx(J,{to:"/admin/dashboard",className:"px-6 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancelar"}),e.jsx("button",{onClick:ge,disabled:D||!r&&!o||!f.trim()||u.length===0||n?.status!=="READY",className:"px-6 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:D?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-5 w-5",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Enviando..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M20.52 3.48A11.77 11.77 0 0 0 12.02 0 11.84 11.84 0 0 0 .15 11.85a11.6 11.6 0 0 0 1.58 5.84L0 24l6.42-1.68a11.85 11.85 0 0 0 5.6 1.42h.01A11.84 11.84 0 0 0 24 11.86a11.7 11.7 0 0 0-3.48-8.38ZM12 21.15h-.01a9.9 9.9 0 0 1-5.04-1.38l-.36-.21-3.81.99 1.02-3.7-.23-.38a9.84 9.84 0 0 1 8.43-15.1h.01a9.8 9.8 0 0 1 9.82 9.84A9.86 9.86 0 0 1 12 21.15Zm5.41-7.36c-.3-.15-1.77-.87-2.04-.97s-.47-.15-.66.15-.76.97-.93 1.17-.34.22-.63.07a8.07 8.07 0 0 1-2.37-1.46 8.84 8.84 0 0 1-1.62-2 1.77 1.77 0 0 1 .11-1.86c.18-.23.4-.48.6-.73s.25-.38.37-.62.06-.45 0-.62-.66-1.59-.91-2.18-.5-.5-.68-.51h-.58a1.12 1.12 0 0 0-.81.38 3.36 3.36 0 0 0-1.06 2.5 5.86 5.86 0 0 0 1.24 3.13 13.35 13.35 0 0 0 5.15 4.52 5.9 5.9 0 0 0 2.4.73 2 2 0 0 0 1.31-.86 1.6 1.6 0 0 0 .11-.86c-.05-.09-.27-.17-.57-.31Z"})}),"Enviar para ",u.length," participante(s)"]})})]})]})}),e.jsx(je,{})]})}export{Re as default};
