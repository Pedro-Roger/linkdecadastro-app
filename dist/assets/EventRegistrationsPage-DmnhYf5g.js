import{j as e,L as F}from"./index-DmKq1tdC.js";import{u as P,i as M,d as r,L as R}from"./react-vendor-40RSlyA9.js";import{M as A}from"./MobileNavbar-DtDdY4Kq.js";import{F as D}from"./Footer-hRPW9HVk.js";import{a as V,g as O}from"./api-WS8dxZuR.js";import{u as U}from"./useAuth-Dhb34Y_Y.js";import{f as B}from"./utils-vendor-DwAQI6Fw.js";import{p as $}from"./NotificationBell-GN2OMXFG.js";import"./ui-vendor-CXsW6q1o.js";function Y(){const h=P(),{eventId:a}=M(),{user:u,loading:n,isAuthenticated:y}=U({requireAuth:!0,redirectTo:"/login"}),[i,N]=r.useState(null),[c,v]=r.useState([]),[k,f]=r.useState(!0),[C,o]=r.useState(!1),[d,E]=r.useState(["number","name","cpf","email","phone","city","state","participantType","classNumber","createdAt"]),L=[{key:"number",label:"Nº"},{key:"name",label:"Nome Completo"},{key:"cpf",label:"CPF"},{key:"email",label:"E-mail"},{key:"phone",label:"Telefone"},{key:"cep",label:"CEP"},{key:"locality",label:"Localidade/Bairro"},{key:"city",label:"Cidade"},{key:"state",label:"Estado"},{key:"participantType",label:"Tipo de Participante"},{key:"otherType",label:"O que você é?"},{key:"pondCount",label:"Quantidade de Viveiros"},{key:"waterDepth",label:"Lâmina d'água (metros)"},{key:"classNumber",label:"Turma"},{key:"status",label:"Status"},{key:"createdAt",label:"Data de Cadastro"}],g=r.useCallback(async()=>{if(a)try{f(!0);const t=await V(`/admin/events/${a}/registrations`,{auth:!0});N(t.event),v(t.registrations)}catch(t){console.error("Erro ao carregar registros:",t),alert("Erro ao carregar registros")}finally{f(!1)}},[a]);r.useEffect(()=>{n||(!y||u?.role!=="ADMIN"?h("/my-courses"):a&&g())},[n,y,u,a,g,h]);const S=t=>{t!=="number"&&E(s=>s.includes(t)?s.filter(m=>m!==t):[...s,t])},x=async t=>{if(!a||d.length===0){alert("Selecione pelo menos um campo para exportar");return}try{const s=d.filter(p=>p!=="number").join(","),m=`${O()}/admin/events/${a}/export?format=${t}&fields=${s}`,b=typeof window<"u"?localStorage.getItem("token"):null,j=await fetch(m,{headers:b?{Authorization:`Bearer ${b}`}:void 0});if(j.ok){const p=await j.blob(),w=window.URL.createObjectURL(p),l=document.createElement("a");l.href=w,l.download=`cadastros-${i?.title?.replace(/[^a-z0-9]/gi,"-").toLowerCase()||"evento"}.${t==="csv"?"csv":t==="pdf"?"pdf":"xlsx"}`,document.body.appendChild(l),l.click(),window.URL.revokeObjectURL(w),document.body.removeChild(l),o(!1)}else alert("Erro ao exportar dados")}catch(s){console.error("Erro ao exportar:",s),alert("Erro ao exportar dados")}},T=t=>({PRODUTOR:"Produtor",ESTUDANTE:"Estudante",PROFESSOR:"Professor",PESQUISADOR:"Pesquisador"})[t]||t;return n||k?e.jsx(F,{}):e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col",children:[e.jsx(A,{}),e.jsx("main",{className:"flex-1",children:e.jsxs("div",{className:"container mx-auto px-4 py-6",children:[e.jsx(R,{to:"/admin/events",className:"text-[#FF6600] hover:underline mb-4 inline-block",children:"← Voltar para Eventos"}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-[#003366] mb-2",children:"Cadastros do Evento"}),i&&e.jsx("p",{className:"text-gray-600 text-lg",children:i.title})]}),e.jsxs("button",{onClick:()=>o(!0),className:"bg-green-600 text-white px-6 py-3 rounded-md font-semibold hover:bg-green-700 transition-colors flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Exportar Dados"]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:c.length===0?e.jsx("div",{className:"p-12 text-center text-gray-500",children:"Nenhum cadastro encontrado para este evento."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Nº"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Nome"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"CPF"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"E-mail"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Telefone"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Cidade"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Estado"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tipo"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Turma"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:c.map((t,s)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:s+1}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:t.name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.cpf}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.email}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.phone}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.city}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.state}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.jsxs("div",{children:[T(t.participantType),t.otherType&&e.jsxs("div",{className:"text-xs text-gray-400",children:["(",t.otherType,")"]}),t.pondCount!==null&&t.pondCount!==void 0&&e.jsxs("div",{className:"text-xs text-gray-400",children:[t.pondCount," viveiros"]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.municipalityClass?.classNumber||t.batchNumber||"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:B(new Date(t.createdAt),"dd/MM/yyyy HH:mm",{locale:$})})]},t.id))})]})})}),e.jsxs("div",{className:"mt-4 text-sm text-gray-600",children:["Total de cadastros: ",e.jsx("strong",{children:c.length})]})]})}),e.jsx(D,{}),C&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 px-4 py-6",children:e.jsxs("div",{className:"w-full max-w-2xl rounded-2xl bg-white shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between border-b px-6 py-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-[#003366]",children:"Exportar Cadastros"}),e.jsx("button",{onClick:()=>o(!1),className:"text-gray-400 transition-colors hover:text-gray-600",children:e.jsx("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"px-6 py-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Selecione os campos para exportar:"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3 max-h-64 overflow-y-auto border border-gray-200 rounded-lg p-4",children:L.map(t=>e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:d.includes(t.key),onChange:()=>S(t.key),disabled:t.key==="number",className:"h-4 w-4 rounded border-gray-300 text-[#FF6600] focus:ring-[#FF6600]"}),e.jsx("span",{className:"text-sm text-gray-700",children:t.label})]},t.key))})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-end",children:[e.jsxs("button",{onClick:()=>x("xlsx"),className:"flex-1 sm:flex-none bg-green-600 text-white px-6 py-2 rounded-md font-semibold hover:bg-green-700 transition-colors flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Excel (XLSX)"]}),e.jsxs("button",{onClick:()=>x("csv"),className:"flex-1 sm:flex-none bg-blue-600 text-white px-6 py-2 rounded-md font-semibold hover:bg-blue-700 transition-colors flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"CSV"]}),e.jsxs("button",{onClick:()=>x("pdf"),className:"flex-1 sm:flex-none bg-red-600 text-white px-6 py-2 rounded-md font-semibold hover:bg-red-700 transition-colors flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"PDF"]}),e.jsx("button",{onClick:()=>o(!1),className:"flex-1 sm:flex-none border border-gray-300 px-6 py-2 rounded-md font-semibold text-gray-600 hover:bg-gray-50 transition-colors",children:"Cancelar"})]})]})]})})]})}export{Y as default};
