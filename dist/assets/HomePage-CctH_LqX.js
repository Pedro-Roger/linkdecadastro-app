import{u as $,j as t}from"./index-CswzOF3x.js";import{u as P,h as O,d as r}from"./react-vendor-40RSlyA9.js";import{F as V}from"./Footer-iGY0art6.js";import{M as q}from"./MobileNavbar-BCn0flnJ.js";import{C as R}from"./CourseEnrollmentModal-CsBsT9AC.js";import{a as C,n as z}from"./api-cc_Vofyw.js";import{f as B}from"./utils-vendor-DwAQI6Fw.js";import{p as W}from"./NotificationBell-Dj7Rk7Dl.js";import"./ui-vendor-VWVTWWFz.js";import"./form-vendor-UKDbifrO.js";import"./zod-Bd6eNPbn.js";function re(){const E=P(),[p]=O(),{isAuthenticated:v}=$(),[w,k]=r.useState([]),[i,L]=r.useState([]),[j,S]=r.useState([]),[x,y]=r.useState(!0),[_,N]=r.useState(!0),[c,A]=r.useState(""),[U,G]=r.useState("courses"),[o,u]=r.useState("all"),[h,H]=r.useState("ALL"),[b,f]=r.useState({isOpen:!1,courseId:"",courseTitle:""}),[m,d]=r.useState(null);r.useEffect(()=>{F(),T()},[]),r.useEffect(()=>{const e=p.get("enroll");if(e&&i.length>0&&!x){const s=i.find(a=>a.slug===e||a.id===e);s&&setTimeout(()=>{f({isOpen:!0,courseId:s.id,courseTitle:s.title}),window.history.replaceState({},"","/")},800)}},[p,i,x]);const D=r.useCallback(()=>{let e=[...i];if(o!=="all"){const s=new Date;e=e.filter(a=>{const n=a.startDate?new Date(a.startDate):null,l=a.endDate?new Date(a.endDate):null;switch(o){case"featured":return!n||n>s;case"available":return!n||n>=s||n<=s&&(!l||l>=s);case"ongoing":return n&&n<=s&&(!l||l>=s);case"closed":return l&&l<s;default:return!0}})}if(c){const s=c.toLowerCase();e=e.filter(a=>a.title.toLowerCase().includes(s)||a.description?.toLowerCase().includes(s)||a.creator.name.toLowerCase().includes(s))}k(e)},[o,c,i]);r.useEffect(()=>{D()},[D]),r.useMemo(()=>{let e=[...j];if(h!=="ALL"&&(e=e.filter(s=>s.status===h)),c){const s=c.toLowerCase();e=e.filter(a=>a.title.toLowerCase().includes(s)||a.description?.toLowerCase().includes(s))}return e},[j,h,c]);const F=async()=>{try{y(!0);const e=await C("/courses");L(e)}catch{}finally{y(!1)}},T=async()=>{try{N(!0);const e=await C("/events");S(e)}catch{}finally{N(!1)}},I=e=>{if(F(),e?.enrollment){const s=e.enrollment.status;if(s==="WAITLIST"){const a=e.metadata?.waitlistPosition;d({message:a&&a>0?`Você entrou na lista de espera. Posição atual: ${a}.`:"Você entrou na lista de espera deste curso. Aguarde a aprovação do administrador.",tone:"info"})}else d(s==="PENDING_REGION"?{message:e.enrollment.eligibilityReason||"Cadastro registrado, aguardando confirmação da equipe.",tone:"warning"}:s==="REJECTED"?{message:e.enrollment.eligibilityReason||"Sua inscrição foi registrada, mas não pôde ser aprovada automaticamente.",tone:"warning"}:{message:'Inscrição confirmada! Você já pode acessar o conteúdo em "Meus Cursos".',tone:"success"})}else d({message:"Solicitação enviada. Verifique seus cursos em alguns instantes.",tone:"info"});setTimeout(()=>d(null),8e3)},M=e=>{const s=new Date,a=e.startDate?new Date(e.startDate):null,n=e.endDate?new Date(e.endDate):null;return n&&n<s?{label:"Encerrado",color:"bg-gray-500",badge:"Encerrado"}:a?a>s?{label:"Inscrições Abertas",color:"bg-green-500",badge:"Inscrições Abertas"}:a<=s&&(!n||n>=s)?{label:"Em Andamento",color:"bg-blue-500",badge:"Em Andamento"}:{label:"Disponível",color:"bg-green-500",badge:"Inscrições Abertas"}:{label:"Inscrições Abertas",color:"bg-green-500",badge:"Inscrições Abertas"}},g=e=>{const s=new Date;return i.filter(a=>{const n=a.startDate?new Date(a.startDate):null,l=a.endDate?new Date(a.endDate):null;switch(e){case"featured":return!n||n>s;case"available":return!n||n>=s||n<=s&&(!l||l>=s);case"ongoing":return n&&n<=s&&(!l||l>=s);case"closed":return l&&l<s;default:return!0}}).length};return t.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col pb-20 md:pb-0",children:[t.jsx(q,{}),t.jsx("div",{className:"bg-white border-b",children:t.jsxs("div",{className:"container mx-auto px-4 py-6 space-y-4",children:[m&&t.jsx("div",{className:`rounded-lg border px-4 py-3 text-sm ${m.tone==="success"?"border-green-200 bg-green-50 text-green-800":m.tone==="warning"?"border-yellow-200 bg-yellow-50 text-yellow-800":"border-blue-200 bg-blue-50 text-blue-800"}`,children:m.message}),t.jsxs("div",{className:"relative max-w-2xl mx-auto",children:[t.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:t.jsx("svg",{className:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),t.jsx("input",{type:"text",placeholder:"Pesquisar cursos por nome, descrição ou local...",value:c,onChange:e=>A(e.target.value),className:"block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#FF6600] focus:border-transparent text-gray-900"})]})]})}),t.jsx("div",{className:"bg-white border-b",children:t.jsx("div",{className:"container mx-auto px-4 py-4",children:t.jsxs("div",{className:"flex flex-wrap gap-3 justify-center",children:[t.jsxs("button",{onClick:()=>u("all"),className:`px-4 py-2 rounded-full font-medium transition-colors ${o==="all"?"bg-[#FF6600] text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Todos os Cursos (",i.length,")"]}),t.jsxs("button",{onClick:()=>u("featured"),className:`px-4 py-2 rounded-full font-medium transition-colors ${o==="featured"?"bg-[#FF6600] text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Em Destaque (",g("featured"),")"]}),t.jsxs("button",{onClick:()=>u("available"),className:`px-4 py-2 rounded-full font-medium transition-colors ${o==="available"?"bg-[#FF6600] text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Disponíveis (",g("available"),")"]}),t.jsxs("button",{onClick:()=>u("ongoing"),className:`px-4 py-2 rounded-full font-medium transition-colors ${o==="ongoing"?"bg-[#FF6600] text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Em Andamento (",g("ongoing"),")"]}),t.jsxs("button",{onClick:()=>u("closed"),className:`px-4 py-2 rounded-full font-medium transition-colors ${o==="closed"?"bg-[#FF6600] text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Encerrados (",g("closed"),")"]})]})})}),t.jsx("div",{className:"container mx-auto px-4 py-8 flex-1",children:x?t.jsx("div",{className:"text-center py-24",children:t.jsx("div",{className:"text-xl text-gray-600",children:"Carregando cursos..."})}):w.length===0?t.jsxs("div",{className:"text-center py-24",children:[t.jsx("p",{className:"text-gray-500 text-lg mb-4",children:"Nenhum curso encontrado."}),t.jsx("p",{className:"text-gray-400",children:"Tente ajustar os filtros ou a busca."})]}):t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:w.map(e=>{const s=M(e),a=!e.startDate||new Date(e.startDate)>new Date,n=e.maxEnrollments&&e._count.enrollments>0?Math.min(100,e._count.enrollments/e.maxEnrollments*100):(e._count.enrollments>0,0);return t.jsxs("div",{className:"relative bg-white rounded-lg shadow-md overflow-hidden hover:shadow-xl transition-shadow",children:[e.bannerUrl&&e.bannerUrl.trim()?t.jsxs("div",{className:"relative w-full h-[386px] overflow-hidden bg-gray-200",children:[t.jsx("img",{src:z(e.bannerUrl),alt:`Banner do curso ${e.title}`,className:"w-full h-full min-w-full min-h-full object-cover",style:{objectFit:"cover",objectPosition:"center"},onError:l=>{l.currentTarget.style.display="none"}}),t.jsx("div",{className:`absolute top-0 left-0 right-0 h-2 ${a?"bg-[#FF6600]":"bg-[#003366]"}`}),a&&t.jsx("div",{className:"absolute top-3 right-3 bg-[#FF6600] text-white text-xs px-2 py-1 rounded-full font-semibold shadow-lg",children:"Destaque"})]}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:`h-2 ${a?"bg-[#FF6600]":"bg-[#003366]"}`}),a&&t.jsx("div",{className:"absolute top-2 right-2 bg-[#FF6600] text-white text-xs px-2 py-1 rounded-full font-semibold",children:"Destaque"})]}),t.jsxs("div",{className:"p-6",children:[t.jsx("div",{className:"mb-3",children:t.jsx("span",{className:`${s.color} text-white text-xs px-2 py-1 rounded-full font-medium`,children:s.badge})}),t.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-2 line-clamp-2",children:e.title}),e.description&&t.jsx("p",{className:"text-gray-600 text-sm mb-4 line-clamp-3",children:e.description}),t.jsxs("div",{className:"space-y-2 mb-4 text-sm text-gray-600",children:[e.startDate&&t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),t.jsx("span",{children:B(new Date(e.startDate),"dd/MM/yyyy",{locale:W})})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),t.jsx("span",{children:"Online"})]}),t.jsx("div",{className:"flex items-center justify-between",children:t.jsxs("span",{className:"text-gray-500",children:[e._count.enrollments,e.maxEnrollments?`/${e.maxEnrollments}`:""," vagas ",e.maxEnrollments?"ocupadas":"inscritos"]})}),t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:t.jsx("div",{className:"bg-[#FF6600] h-2 rounded-full transition-all",style:{width:`${n}%`}})})]}),t.jsx("button",{onClick:()=>{v?f({isOpen:!0,courseId:e.id,courseTitle:e.title}):E("/login")},className:"block w-full bg-[#FF6600] text-white text-center py-3 rounded-md font-semibold hover:bg-[#e55a00] transition-colors",children:"Cadastrar-se no Curso"})]})]},e.id)})})}),t.jsx(V,{}),v&&t.jsx("div",{className:"md:hidden h-20"}),t.jsx(R,{isOpen:b.isOpen,onClose:()=>f({isOpen:!1,courseId:"",courseTitle:""}),courseId:b.courseId,courseTitle:b.courseTitle,onSuccess:I})]})}export{re as default};
