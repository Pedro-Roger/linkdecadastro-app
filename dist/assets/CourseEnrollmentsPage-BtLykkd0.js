import{u as z,j as e,L as B}from"./index-CsxD5A8A.js";import{u as R,i as T,d as a,L as n}from"./react-vendor-40RSlyA9.js";import{N as U,p as V}from"./NotificationBell-ZfODFpwn.js";import{F as O}from"./Footer-Cs2AOzBe.js";import{a as L,g as H}from"./api-cc_Vofyw.js";import{f as W}from"./utils-vendor-DwAQI6Fw.js";import"./ui-vendor-VWVTWWFz.js";function K(){const f=R(),{user:p,loading:u,isAuthenticated:N,signOut:A}=z({requireAuth:!0,redirectTo:"/login"}),r=T().courseId,[d,v]=a.useState([]),[g,S]=a.useState(null),[$,w]=a.useState(!0),[P,x]=a.useState(!1),[o,b]=a.useState("xlsx"),[i,m]=a.useState(["number","name","email","status","progress","createdAt"]),[y,k]=a.useState(!1),F=[{key:"number",label:"Nº"},{key:"name",label:"Nome"},{key:"email",label:"Email"},{key:"whatsapp",label:"WhatsApp"},{key:"status",label:"Status"},{key:"progress",label:"Progresso (%)"},{key:"participantType",label:"Tipo de Participante"},{key:"cpf",label:"CPF"},{key:"state",label:"Estado"},{key:"city",label:"Cidade"},{key:"createdAt",label:"Data de Inscrição"},{key:"completedAt",label:"Data de Conclusão"},{key:"waitlistPosition",label:"Posição na Lista de Espera"},{key:"eligibilityReason",label:"Observações"}],C=a.useCallback(async()=>{try{w(!0);const[s,t]=await Promise.all([L(`/admin/courses/${r}/enrollments`,{auth:!0}),L(`/admin/courses/${r}`,{auth:!0})]);console.log("Inscrições carregadas:",s),console.log("Curso carregado:",t),v(s||[]),S(t)}catch(s){console.error("Erro ao carregar inscrições:",s),v([])}finally{w(!1)}},[r]);a.useEffect(()=>{u||(!N||p?.role!=="ADMIN"?f("/my-courses"):r&&C())},[u,N,p,r,C,f]);const D=s=>{m(t=>t.includes(s)?t.filter(h=>h!==s):[...t,s])},M=async()=>{if(i.length===0){alert("Selecione pelo menos um campo para exportar");return}k(!0);try{const s=i.join(","),t=`${H()}/admin/courses/${r}/export?format=${o}&fields=${encodeURIComponent(s)}`,h=typeof window<"u"?localStorage.getItem("token"):null,l=await fetch(t,{headers:h?{Authorization:`Bearer ${h}`}:void 0});if(l.ok){const j=await l.blob(),E=window.URL.createObjectURL(j),c=document.createElement("a");c.href=E;const I=o==="pdf"?"pdf":o==="csv"?"csv":"xlsx";c.download=`inscritos-${g?.title?.replace(/[^a-z0-9]/gi,"-").toLowerCase()||"curso"}.${I}`,document.body.appendChild(c),c.click(),window.URL.revokeObjectURL(E),document.body.removeChild(c),x(!1)}else{const j=await l.text();console.error("Erro ao exportar:",l.status,j),alert(`Erro ao exportar dados: ${l.status} ${l.statusText}`)}}catch(s){console.error("Erro ao exportar:",s),alert(`Erro ao exportar dados: ${s instanceof Error?s.message:"Erro desconhecido"}`)}finally{k(!1)}};return u||$?e.jsx(B,{}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("header",{className:"bg-white shadow-sm sticky top-0 z-50",children:e.jsx("div",{className:"container mx-auto px-4 py-2",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between space-y-2 md:space-y-0",children:[e.jsx(n,{to:"/",className:"flex items-center",children:e.jsx("img",{src:"/logo B.png",alt:"Link de Cadastro",className:"h-20 md:h-24 w-auto object-contain"})}),e.jsxs("nav",{className:"flex items-center space-x-4 md:space-x-6 text-sm md:text-base",children:[e.jsx(n,{to:"/admin/dashboard",className:"text-gray-700 hover:text-[#FF6600]",children:"Dashboard"}),e.jsx(n,{to:"/admin/courses",className:"text-gray-700 hover:text-[#FF6600]",children:"Cursos"}),e.jsx(n,{to:"/admin/events",className:"text-gray-700 hover:text-[#FF6600]",children:"Eventos"}),e.jsx(U,{}),e.jsx(n,{to:"/profile",className:"w-8 h-8 md:w-10 md:h-10 rounded-full bg-[#FF6600] text-white font-bold flex items-center justify-center",children:p?.name?.charAt(0).toUpperCase()||"A"}),e.jsx("button",{onClick:()=>A(),className:"bg-red-500 text-white px-4 py-2 rounded-md font-semibold hover:bg-red-600 transition-colors text-sm md:text-base",children:"Sair"})]})]})})}),e.jsxs("div",{className:"container mx-auto px-4 py-8 pb-24 md:pb-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx(n,{to:"/admin/courses",className:"text-[#FF6600] hover:underline mb-4 inline-block",children:"← Voltar para Cursos"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-[#003366] mb-2",children:"Inscritos no Curso"}),g&&e.jsx("p",{className:"text-gray-600 text-lg",children:g.title})]}),e.jsxs("button",{onClick:()=>x(!0),className:"bg-green-600 text-white px-6 py-3 rounded-md font-semibold hover:bg-green-700 transition-colors flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Exportar Dados"]})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Nº"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Nome"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Progresso"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data de Inscrição"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:d.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-8 text-center text-gray-500",children:"Nenhum inscrito encontrado."})}):d.map((s,t)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:t+1}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:s.user.name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:s.user.email}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-16 bg-gray-200 rounded-full h-2 mr-2",children:e.jsx("div",{className:"bg-[#FF6600] h-2 rounded-full transition-all",style:{width:`${s.progress}%`}})}),e.jsxs("span",{className:"text-sm text-gray-600",children:[s.progress,"%"]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:W(new Date(s.createdAt),"dd/MM/yyyy HH:mm",{locale:V})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:s.completedAt?e.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800",children:"Concluído"}):e.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-yellow-100 text-yellow-800",children:"Em Andamento"})})]},s.id))})]})})}),d.length>0&&e.jsxs("div",{className:"mt-4 text-sm text-gray-600",children:["Total de inscritos: ",e.jsx("strong",{children:d.length})]})]}),e.jsx(O,{}),P&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-[#003366]",children:"Exportar Dados dos Participantes"}),e.jsx("button",{onClick:()=>x(!1),className:"text-gray-500 hover:text-gray-700",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Formato de Exportação"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("button",{onClick:()=>b("xlsx"),className:`px-4 py-3 rounded-lg border-2 transition-colors ${o==="xlsx"?"border-[#FF6600] bg-[#FF6600] text-white":"border-gray-300 hover:border-gray-400"}`,children:[e.jsx("div",{className:"font-semibold",children:"Excel"}),e.jsx("div",{className:"text-xs mt-1",children:".xlsx"})]}),e.jsxs("button",{onClick:()=>b("csv"),className:`px-4 py-3 rounded-lg border-2 transition-colors ${o==="csv"?"border-[#FF6600] bg-[#FF6600] text-white":"border-gray-300 hover:border-gray-400"}`,children:[e.jsx("div",{className:"font-semibold",children:"CSV"}),e.jsx("div",{className:"text-xs mt-1",children:".csv"})]}),e.jsxs("button",{onClick:()=>b("pdf"),className:`px-4 py-3 rounded-lg border-2 transition-colors ${o==="pdf"?"border-[#FF6600] bg-[#FF6600] text-white":"border-gray-300 hover:border-gray-400"}`,children:[e.jsx("div",{className:"font-semibold",children:"PDF"}),e.jsx("div",{className:"text-xs mt-1",children:".pdf"})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Campos para Exportar"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>m(F.map(s=>s.key)),className:"text-xs text-[#FF6600] hover:underline",children:"Selecionar Todos"}),e.jsx("span",{className:"text-xs text-gray-400",children:"|"}),e.jsx("button",{onClick:()=>m(["number","name","email","status","progress","createdAt"]),className:"text-xs text-[#FF6600] hover:underline",children:"Padrão"}),e.jsx("span",{className:"text-xs text-gray-400",children:"|"}),e.jsx("button",{onClick:()=>m([]),className:"text-xs text-[#FF6600] hover:underline",children:"Limpar"})]})]}),e.jsx("div",{className:"border border-gray-300 rounded-lg p-4 max-h-64 overflow-y-auto",children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:F.map(s=>e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer hover:bg-gray-50 p-2 rounded",children:[e.jsx("input",{type:"checkbox",checked:i.includes(s.key),onChange:()=>D(s.key),className:"w-4 h-4 text-[#FF6600] border-gray-300 rounded focus:ring-[#FF6600]"}),e.jsx("span",{className:"text-sm text-gray-700",children:s.label})]},s.key))})}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:[i.length," campo(s) selecionado(s)"]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>x(!1),className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition-colors",disabled:y,children:"Cancelar"}),e.jsx("button",{onClick:M,disabled:y||i.length===0,className:"px-6 py-2 bg-[#FF6600] text-white rounded-md hover:bg-[#e55a00] transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:y?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-4 w-4",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Exportando..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Exportar"]})})]})]})})})]})}export{K as default};
