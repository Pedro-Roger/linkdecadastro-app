import{j as e,L as S}from"./index-D8JjrtT-.js";import{u as $,d as i,L as c}from"./react-vendor-40RSlyA9.js";import{M as P}from"./MobileNavbar-8P0RqRjd.js";import{F as B}from"./Footer-DuvVzgub.js";import{a as p}from"./api-BbTxKhym.js";import{u as R}from"./useAuth-Dhb34Y_Y.js";import{f as E}from"./utils-vendor-DwAQI6Fw.js";import{p as k}from"./NotificationBell-D1UsW_iU.js";import"./ui-vendor-CXsW6q1o.js";function U(){const j=$(),{user:x,loading:h,isAuthenticated:f}=R({requireAuth:!0,redirectTo:"/login"}),[a,A]=i.useState(null),[u,D]=i.useState([]),[N,T]=i.useState([]),[L,g]=i.useState(!0),[y,w]=i.useState(null),[b,I]=i.useState(""),[o,d]=i.useState("all"),C=i.useCallback(async()=>{try{const[s,t]=await Promise.all([p("/admin/courses",{auth:!0}),p("/events",{auth:!0})]);D(s);const l=s.reduce((r,n)=>r+(n._count?.enrollments||0),0);A({totalCourses:s.length,totalEvents:t.length,activeCourses:s.filter(r=>r.status==="ACTIVE").length,inactiveCourses:s.filter(r=>r.status==="INACTIVE").length,activeEvents:t.filter(r=>r.status==="ACTIVE").length,totalEnrollments:l}),await V(s)}catch(s){console.error("Erro ao buscar estatísticas:",s);const t=s instanceof Error?s.message:"Erro ao carregar dados do dashboard";w(t),g(!1)}finally{g(!1)}},[]);i.useEffect(()=>{if(!h){if(!f||x?.role!=="ADMIN"){j("/my-courses");return}C()}},[h,f,x,j]);async function V(s){try{const t=s.slice(0,5).map(m=>p(`/admin/courses/${m.id}/enrollments`,{auth:!0}).then(v=>v.map(M=>({...M,courseTitle:m.title}))).catch(()=>[])),n=(await Promise.all(t)).flat().sort((m,v)=>new Date(v.createdAt).getTime()-new Date(m.createdAt).getTime()).slice(0,10);T(n)}catch(t){console.error("Erro ao buscar inscrições recentes:",t)}}const F=(()=>{let s=[...u];if(o!=="all"){const t=new Date;s=s.filter(l=>{const r=l.startDate?new Date(l.startDate):null,n=l.endDate?new Date(l.endDate):null;switch(o){case"active":return l.status==="ACTIVE";case"inactive":return l.status==="INACTIVE";case"available":return!r||r>=t||r<=t&&(!n||n>=t);case"ongoing":return r&&r<=t&&(!n||n>=t);case"closed":return n&&n<t;default:return!0}})}if(b){const t=b.toLowerCase();s=s.filter(l=>l.title.toLowerCase().includes(t)||l.description?.toLowerCase().includes(t))}return s})();return h||L?e.jsx(S,{}):y?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center p-8",children:[e.jsx("h1",{className:"text-2xl font-bold text-red-600 mb-4",children:"Erro ao carregar dashboard"}),e.jsx("p",{className:"text-gray-600 mb-4",children:y}),e.jsx("button",{onClick:()=>{w(null),g(!0),C()},className:"bg-[#FF6600] text-white px-6 py-3 rounded-md font-semibold hover:bg-[#e55a00] transition-colors",children:"Tentar novamente"})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col",children:[e.jsx(P,{}),e.jsx("div",{className:"bg-white border-b",children:e.jsx("div",{className:"container mx-auto px-4 py-6",children:e.jsxs("div",{className:"relative max-w-2xl mx-auto",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{className:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",placeholder:"Pesquisar cursos por nome, descrição...",value:b,onChange:s=>I(s.target.value),className:"block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#FF6600] focus:border-transparent text-gray-900"})]})})}),e.jsx("div",{className:"bg-white border-b",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex flex-wrap gap-3 justify-center",children:[e.jsxs("button",{onClick:()=>d("all"),className:`px-4 py-2 rounded-full font-medium transition-colors ${o==="all"?"bg-[#FF6600] text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Todos (",u.length,")"]}),e.jsxs("button",{onClick:()=>d("active"),className:`px-4 py-2 rounded-full font-medium transition-colors ${o==="active"?"bg-[#FF6600] text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Ativos (",a?.activeCourses||0,")"]}),e.jsxs("button",{onClick:()=>d("inactive"),className:`px-4 py-2 rounded-full font-medium transition-colors ${o==="inactive"?"bg-[#FF6600] text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Inativos (",a?.inactiveCourses||0,")"]}),e.jsx("button",{onClick:()=>d("available"),className:`px-4 py-2 rounded-full font-medium transition-colors ${o==="available"?"bg-[#FF6600] text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Disponíveis"}),e.jsx("button",{onClick:()=>d("ongoing"),className:`px-4 py-2 rounded-full font-medium transition-colors ${o==="ongoing"?"bg-[#FF6600] text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Em Andamento"}),e.jsx("button",{onClick:()=>d("closed"),className:`px-4 py-2 rounded-full font-medium transition-colors ${o==="closed"?"bg-[#FF6600] text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Encerrados"})]})})}),e.jsxs("div",{className:"container mx-auto px-4 py-8 pb-24 md:pb-8 flex-1",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-[#003366] mb-2",children:"Painel de Controle"}),e.jsx("p",{className:"text-gray-600",children:"Gerenciamento e moderação de conteúdos"})]}),a&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-8",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 border-l-4 border-[#FF6600]",children:[e.jsx("div",{className:"text-2xl font-bold text-[#FF6600] mb-1",children:a.totalCourses}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total de Cursos"}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[a.activeCourses," ativos • ",a.inactiveCourses," inativos"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 border-l-4 border-blue-500",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-500 mb-1",children:a.totalEnrollments||0}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total de Inscrições"}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[u.reduce((s,t)=>s+(t._count?.enrollments||0),0)," alunos"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 border-l-4 border-green-500",children:[e.jsx("div",{className:"text-2xl font-bold text-green-500 mb-1",children:a.activeCourses}),e.jsx("div",{className:"text-sm text-gray-600",children:"Cursos Ativos"}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[(a.activeCourses/a.totalCourses*100||0).toFixed(0),"% do total"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 border-l-4 border-purple-500",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-500 mb-1",children:a.totalEvents}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total de Eventos"}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[a.activeEvents," ativos"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-8",children:[e.jsxs(c,{to:"/admin/courses/new",className:"bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow border-l-4 border-[#FF6600]",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("svg",{className:"w-8 h-8 text-[#FF6600]",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),e.jsx("h2",{className:"text-lg font-semibold text-[#003366]",children:"Criar Curso"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Adicionar novo curso à plataforma"})]}),e.jsxs(c,{to:"/admin/courses",className:"bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow border-l-4 border-blue-500",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("svg",{className:"w-8 h-8 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})}),e.jsx("h2",{className:"text-lg font-semibold text-[#003366]",children:"Gerenciar Cursos"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Visualizar e editar cursos existentes"})]}),e.jsxs(c,{to:"/admin/events",className:"bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow border-l-4 border-green-500",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("svg",{className:"w-8 h-8 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("h2",{className:"text-lg font-semibold text-[#003366]",children:"Gerenciar Eventos"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Visualizar e editar eventos existentes"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-[#003366]",children:"Cursos Disponíveis"}),e.jsx(c,{to:"/admin/courses",className:"text-sm text-[#FF6600] hover:underline font-medium",children:"Ver todos →"})]}),F.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-500 text-lg mb-4",children:"Nenhum curso encontrado."}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Tente ajustar os filtros ou a busca."})]}):e.jsx("div",{className:"space-y-3",children:F.slice(0,5).map(s=>e.jsx("div",{className:"p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"font-semibold text-[#003366]",children:s.title}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${s.status==="ACTIVE"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:s.status==="ACTIVE"?"Ativo":"Inativo"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500 mb-2",children:[e.jsxs("span",{children:[s.lessons?.length||0," aulas"]}),e.jsxs("span",{children:[s._count?.enrollments||0," alunos"]}),s.startDate&&e.jsx("span",{children:E(new Date(s.startDate),"dd/MM/yyyy",{locale:k})})]}),s.description&&e.jsx("p",{className:"text-sm text-gray-600 line-clamp-2",children:s.description})]}),e.jsx("div",{className:"flex items-center gap-2 ml-4",children:e.jsx(c,{to:`/admin/courses/${s.id}/lessons`,className:"px-3 py-1 bg-[#FF6600] text-white text-sm rounded-md hover:bg-[#e55a00] transition-colors",children:"Gerenciar"})})]})},s.id))})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-[#003366]",children:"Inscrições Recentes"}),e.jsx(c,{to:"/admin/courses",className:"text-sm text-[#FF6600] hover:underline font-medium",children:"Ver todas →"})]}),N.length===0?e.jsx("p",{className:"text-gray-500 text-center py-8",children:"Nenhuma inscrição recente."}):e.jsx("div",{className:"space-y-3",children:N.map(s=>e.jsxs("div",{className:"p-4 border border-gray-200 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-[#003366]",children:s.user.name}),e.jsx("p",{className:"text-sm text-gray-500",children:s.user.email})]}),e.jsx("span",{className:"text-xs text-gray-500",children:E(new Date(s.createdAt),"dd/MM/yyyy HH:mm",{locale:k})})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:s.courseTitle}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-[#FF6600] h-2 rounded-full transition-all",style:{width:`${s.progress}%`}})}),e.jsxs("span",{className:"text-xs text-gray-600",children:[s.progress,"%"]})]})]})]},s.id))})]})]}),e.jsx(B,{}),x&&e.jsx("div",{className:"md:hidden h-20"})]})}export{U as default};
