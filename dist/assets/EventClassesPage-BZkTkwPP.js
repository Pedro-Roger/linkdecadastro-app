import{u as D,j as e,L as F}from"./index-DwEMJ_lJ.js";import{u as O,i as R,d as s,L as M}from"./react-vendor-40RSlyA9.js";import{M as H}from"./MobileNavbar-C6rzZ9zd.js";import{F as z}from"./Footer-DnE7w3F5.js";import{a as l}from"./api-cc_Vofyw.js";import{f as w}from"./utils-vendor-DwAQI6Fw.js";import{p as E}from"./NotificationBell-BDD7Eyci.js";import"./ui-vendor-VWVTWWFz.js";function K(){const h=O(),{eventId:r}=R(),{user:u,loading:c,isAuthenticated:g}=D({requireAuth:!0,redirectTo:"/login"}),[y,C]=s.useState(null),[i,T]=s.useState(null),[L,f]=s.useState(!0),[A,o]=s.useState(null),[x,m]=s.useState(20),[n,j]=s.useState(!1),[b,N]=s.useState(null),d=s.useCallback(async()=>{if(r)try{f(!0);const[t,a]=await Promise.all([l(`/admin/events/${r}`,{auth:!0}).catch(()=>l("/events",{auth:!0}).then(p=>p.events.find(k=>k.id===r))),l(`/admin/events/${r}/regions`,{auth:!0})]);t&&C(t),T(a)}catch(t){console.error("Erro ao carregar dados:",t),alert("Erro ao carregar dados")}finally{f(!1)}},[r]);s.useEffect(()=>{c||(!g||u?.role!=="ADMIN"?h("/my-courses"):r&&d())},[c,g,u,r,d,h]);const S=async t=>{if(x<=0){alert("O limite deve ser maior que zero");return}j(!0);try{await l(`/admin/events/limits/${t}`,{method:"PATCH",auth:!0,body:JSON.stringify({defaultLimit:x})}),o(null),await d(),alert("Limite atualizado com sucesso!")}catch(a){console.error("Erro ao atualizar limite:",a),alert("Erro ao atualizar limite")}finally{j(!1)}},P=async t=>{if(confirm("Tem certeza que deseja encerrar esta turma? Esta ação não pode ser desfeita.")){N(t);try{await l(`/admin/events/classes/${t}/close`,{method:"PATCH",auth:!0}),await d(),alert("Turma encerrada com sucesso!")}catch(a){console.error("Erro ao encerrar turma:",a),alert(a instanceof Error?a.message:"Erro ao encerrar turma")}finally{N(null)}}},v=t=>({PRODUTOR:"Produtor",ESTUDANTE:"Estudante",PROFESSOR:"Professor",PESQUISADOR:"Pesquisador"})[t]||t;return c||L?e.jsx(F,{}):i?e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col",children:[e.jsx(H,{}),e.jsx("main",{className:"flex-1",children:e.jsxs("div",{className:"container mx-auto px-4 py-6",children:[e.jsx(M,{to:"/admin/events",className:"text-[#FF6600] hover:underline mb-4 inline-block",children:"← Voltar para Eventos"}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-[#003366] mb-2",children:"Gerenciamento de Turmas"}),y&&e.jsx("p",{className:"text-gray-600 text-lg",children:y.title}),e.jsx("div",{className:"mt-4 p-4 bg-white rounded-lg shadow-sm",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Total de Cadastros"}),e.jsx("p",{className:"text-2xl font-bold text-[#003366]",children:i.overall.totalRegistrations})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Municípios"}),e.jsx("p",{className:"text-2xl font-bold text-[#003366]",children:i.regions.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Por Tipo"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-1",children:Object.entries(i.overall.byParticipantType).map(([t,a])=>e.jsxs("span",{className:"text-xs bg-gray-100 px-2 py-1 rounded",children:[v(t),": ",a]},t))})]})]})})]}),i.regions.length===0?e.jsx("div",{className:"bg-white rounded-lg shadow-md p-12 text-center",children:e.jsx("p",{className:"text-gray-500 text-lg",children:"Nenhum município cadastrado ainda."})}):e.jsx("div",{className:"space-y-6",children:i.regions.map(t=>e.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-[#003366] to-[#FF6600] px-6 py-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-white",children:[t.municipality," - ",t.state]}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-4 text-sm text-white/90",children:[e.jsxs("span",{children:["Total: ",e.jsx("strong",{children:t.totalRegistrations})," ","cadastros"]}),e.jsxs("span",{children:["Limite padrão: ",e.jsx("strong",{children:t.defaultLimit})," ","vagas"]}),t.activeClassNumber&&e.jsxs("span",{children:["Turma Ativa: ",e.jsxs("strong",{children:["Turma ",t.activeClassNumber]})," ","(",t.activeClassCount,"/",t.activeClassLimit," vagas)"]})]}),Object.keys(t.byParticipantType).length>0&&e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:Object.entries(t.byParticipantType).map(([a,p])=>e.jsxs("span",{className:"text-xs bg-white/20 px-2 py-1 rounded",children:[v(a),": ",p]},a))})]}),e.jsx("div",{className:"flex gap-2",children:A===t.id?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",value:x,onChange:a=>m(parseInt(a.target.value)||0),min:"1",className:"px-3 py-2 rounded-md border border-gray-300 w-24 text-gray-900",disabled:n}),e.jsx("button",{onClick:()=>S(t.id),disabled:n,className:"bg-green-600 text-white px-4 py-2 rounded-md font-semibold hover:bg-green-700 transition-colors disabled:opacity-50",children:n?"Salvando...":"Salvar"}),e.jsx("button",{onClick:()=>{o(null),m(t.defaultLimit)},disabled:n,className:"bg-gray-500 text-white px-4 py-2 rounded-md font-semibold hover:bg-gray-600 transition-colors disabled:opacity-50",children:"Cancelar"})]}):e.jsx("button",{onClick:()=>{o(t.id),m(t.defaultLimit)},className:"bg-[#FF6600] text-white px-4 py-2 rounded-md font-semibold hover:bg-[#e55a00] transition-colors",children:"Editar Limite"})})]})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-[#003366] mb-4",children:["Turmas (",t.classes.length,")"]}),t.classes.length===0?e.jsx("p",{className:"text-gray-500 text-sm",children:"Nenhuma turma criada ainda."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Turma"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Limite"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Cadastros"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Criada em"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Encerrada em"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Ações"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.classes.map(a=>e.jsxs("tr",{className:a.status==="ACTIVE"?"bg-green-50":"",children:[e.jsxs("td",{className:"px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900",children:["Turma ",a.classNumber]}),e.jsxs("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500",children:[a.limit," vagas"]}),e.jsxs("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500",children:[e.jsx("span",{className:"font-semibold",children:a.currentCount})," ","cadastros"]}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex items-center rounded-full px-3 py-1 text-xs font-semibold ${a.status==="ACTIVE"?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"}`,children:a.status==="ACTIVE"?"Ativa":"Encerrada"})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500",children:w(new Date(a.createdAt),"dd/MM/yyyy HH:mm",{locale:E})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500",children:a.closedAt?w(new Date(a.closedAt),"dd/MM/yyyy HH:mm",{locale:E}):"-"}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm",children:a.status==="ACTIVE"&&e.jsx("button",{onClick:()=>P(a.id),disabled:b===a.id,className:"bg-red-600 text-white px-3 py-1 rounded-md font-semibold hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:b===a.id?"Encerrando...":"Encerrar"})})]},a.id))})]})})]})]},t.id))})]})}),e.jsx(z,{})]}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsx("div",{className:"text-xl text-red-600",children:"Erro ao carregar dados"})})}export{K as default};
