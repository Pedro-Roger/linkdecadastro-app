import{j as e,L as S}from"./index-Be2nDD7h.js";import{u as I,d as o}from"./react-vendor-40RSlyA9.js";import{F as L}from"./Footer-V4s9KLyK.js";import{M as T}from"./MobileNavbar-CCv_Lw7-.js";import{C as M}from"./CourseEnrollmentModal-BZerrH7d.js";import{a as $,n as A}from"./api-cc_Vofyw.js";import{f as P}from"./utils-vendor-DwAQI6Fw.js";import{p as V}from"./NotificationBell-N0atiB6o.js";import"./ui-vendor-VWVTWWFz.js";import"./form-vendor-UKDbifrO.js";import"./zod-Bd6eNPbn.js";function K(){const f=I(),[d,w]=o.useState([]),[p,N]=o.useState([]),[b,D]=o.useState(!0),[m,C]=o.useState(""),[l,c]=o.useState("all"),[h,y]=o.useState({isOpen:!1,courseId:"",courseTitle:""}),[u,i]=o.useState(null);o.useEffect(()=>{if(!(typeof window<"u"?localStorage.getItem("token"):null)){f("/login");return}v()},[]);const j=o.useCallback(()=>{let t=[...d];if(l!=="all"){const s=new Date;t=t.filter(n=>{const a=n.startDate?new Date(n.startDate):null,r=n.endDate?new Date(n.endDate):null;switch(l){case"available":return!a||a>=s||a<=s&&(!r||r>=s);case"ongoing":return a&&a<=s&&(!r||r>=s);case"upcoming":return a&&a>s;case"closed":return r&&r<s;default:return!0}})}if(m){const s=m.toLowerCase();t=t.filter(n=>n.title.toLowerCase().includes(s)||n.description?.toLowerCase().includes(s)||n.creator?.name?.toLowerCase().includes(s))}N(t)},[l,m,d]);o.useEffect(()=>{j()},[j]);async function v(){try{const t=await $("/courses",{auth:!0});w(t)}catch{f("/login")}finally{D(!1)}}const g=t=>{const s=new Date;return d.filter(n=>{const a=n.startDate?new Date(n.startDate):null,r=n.endDate?new Date(n.endDate):null;switch(t){case"available":return!a||a>=s||a<=s&&(!r||r>=s);case"ongoing":return a&&a<=s&&(!r||r>=s);case"upcoming":return a&&a>s;case"closed":return r&&r<s;default:return!0}}).length},F=(t,s)=>{if(!(typeof window<"u"?localStorage.getItem("token"):null)){f("/login");return}y({isOpen:!0,courseId:t,courseTitle:s})},k=t=>{if(v(),t?.enrollment){const s=t.enrollment.status;if(s==="WAITLIST"){const n=t.metadata?.waitlistPosition;i({message:n&&n>0?`Você entrou na lista de espera. Posição atual: ${n}.`:"Você entrou na lista de espera deste curso. Aguarde a aprovação do administrador.",tone:"info"})}else i(s==="PENDING_REGION"?{message:t.enrollment.eligibilityReason||"Cadastro registrado, aguardando confirmação da equipe.",tone:"warning"}:s==="REJECTED"?{message:t.enrollment.eligibilityReason||"Sua inscrição foi registrada, mas não pôde ser aprovada automaticamente.",tone:"warning"}:{message:'Inscrição confirmada! Você já pode acessar o conteúdo em "Meus Cursos".',tone:"success"})}else i({message:"Solicitação enviada. Verifique seus cursos em alguns instantes.",tone:"info"});setTimeout(()=>i(null),8e3)};return b?e.jsx(S,{}):e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col",children:[e.jsx(T,{}),e.jsx("div",{className:"bg-white border-b",children:e.jsxs("div",{className:"container mx-auto px-4 py-6 space-y-4",children:[u&&e.jsx("div",{className:`rounded-lg border px-4 py-3 text-sm ${u.tone==="success"?"border-green-200 bg-green-50 text-green-800":u.tone==="warning"?"border-yellow-200 bg-yellow-50 text-yellow-800":"border-blue-200 bg-blue-50 text-blue-800"}`,children:u.message}),e.jsxs("div",{className:"relative max-w-2xl mx-auto",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{className:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",placeholder:"Pesquisar cursos por nome, descrição ou instrutor...",value:m,onChange:t=>C(t.target.value),className:"block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#FF6600] focus:border-transparent text-gray-900"})]})]})}),e.jsx("div",{className:"bg-white border-b",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex flex-wrap gap-3 justify-center",children:[e.jsxs("button",{onClick:()=>c("all"),className:`px-4 py-2 rounded-full font-medium transition-colors ${l==="all"?"bg-[#FF6600] text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Todos (",d.length,")"]}),e.jsxs("button",{onClick:()=>c("available"),className:`px-4 py-2 rounded-full font-medium transition-colors ${l==="available"?"bg-[#FF6600] text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Inscrições Abertas (",g("available"),")"]}),e.jsxs("button",{onClick:()=>c("ongoing"),className:`px-4 py-2 rounded-full font-medium transition-colors ${l==="ongoing"?"bg-[#FF6600] text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Em Andamento (",g("ongoing"),")"]}),e.jsxs("button",{onClick:()=>c("upcoming"),className:`px-4 py-2 rounded-full font-medium transition-colors ${l==="upcoming"?"bg-[#FF6600] text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Em Breve (",g("upcoming"),")"]}),e.jsxs("button",{onClick:()=>c("closed"),className:`px-4 py-2 rounded-full font-medium transition-colors ${l==="closed"?"bg-[#FF6600] text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Encerradas (",g("closed"),")"]})]})})}),e.jsxs("div",{className:"container mx-auto px-4 py-8 pb-24 md:pb-8 flex-1",children:[e.jsx("h1",{className:"text-3xl font-bold mb-8 text-[#003366]",children:"Cursos Disponíveis"}),b?e.jsx("div",{className:"text-center py-24",children:e.jsx("div",{className:"text-xl text-gray-600",children:"Carregando cursos..."})}):p.length===0?e.jsxs("div",{className:"text-center py-24",children:[e.jsx("p",{className:"text-gray-500 text-lg mb-4",children:"Nenhum curso encontrado."}),e.jsx("p",{className:"text-gray-400",children:"Tente ajustar os filtros ou a busca."})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:p.map(t=>{const s=new Date,n=t.startDate?new Date(t.startDate):null,a=t.endDate?new Date(t.endDate):null;let r="Disponível",x="bg-green-500";return a&&a<s?(r="Encerrado",x="bg-gray-500"):n&&n>s?(r="Em Breve",x="bg-blue-500"):n&&n<=s&&(!a||a>=s)&&(r="Em Andamento",x="bg-orange-500"),e.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow",children:[t.bannerUrl&&t.bannerUrl.trim()?e.jsx("div",{className:"relative w-full h-[386px] overflow-hidden bg-gray-200",children:e.jsx("img",{src:A(t.bannerUrl),alt:`Banner do curso ${t.title}`,className:"w-full h-full min-w-full min-h-full object-cover",style:{objectFit:"cover",objectPosition:"center"},onError:E=>{E.currentTarget.style.display="none"}})}):e.jsx("div",{className:"w-full h-[386px] bg-gradient-to-br from-[#003366] to-[#FF6600] flex items-center justify-center",children:e.jsx("span",{className:"text-white text-sm font-medium",children:"Sem banner"})}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx("span",{className:`${x} text-white text-xs px-2 py-1 rounded-full font-medium`,children:r})}),e.jsx("h2",{className:"text-xl font-semibold mb-2 text-[#003366]",children:t.title}),e.jsx("p",{className:"text-gray-600 text-sm mb-4 line-clamp-2",children:t.description}),e.jsxs("div",{className:"space-y-2 mb-4 text-sm text-gray-500",children:[n&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("span",{children:P(new Date(n),"dd/MM/yyyy",{locale:V})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:[t._count?.lessons||0," aulas"]}),e.jsxs("span",{className:"text-sm text-gray-500",children:[t._count?.enrollments||0," alunos"]})]})]}),e.jsx("button",{onClick:()=>F(t.id,t.title),className:"w-full bg-[#FF6600] text-white py-2 px-4 rounded-md font-semibold hover:bg-[#e55a00] transition-colors",children:"Inscrever-se"})]})]},t.id)})})]}),e.jsx(L,{}),e.jsx("div",{className:"md:hidden h-20"}),e.jsx(M,{isOpen:h.isOpen,onClose:()=>y({isOpen:!1,courseId:"",courseTitle:""}),courseId:h.courseId,courseTitle:h.courseTitle,onSuccess:k})]})}export{K as default};
