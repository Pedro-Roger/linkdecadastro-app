import{j as e}from"./index-CKd_6dCy.js";import{u as E,d as l}from"./react-vendor-40RSlyA9.js";import{F as A}from"./Footer-CrxvJtYf.js";import{M as I}from"./MobileNavbar-CEnw9uOl.js";import{C as L}from"./CourseEnrollmentModal-DjfhW98F.js";import{a as M}from"./api-WS8dxZuR.js";import{u as S}from"./useAuth-Dhb34Y_Y.js";import{f as T}from"./utils-vendor-DwAQI6Fw.js";import{p as $}from"./NotificationBell-B3QQdthT.js";import"./ui-vendor-CXsW6q1o.js";import"./form-vendor-UKDbifrO.js";import"./zod-Bd6eNPbn.js";function J(){const w=E(),{isAuthenticated:h}=S(),[b,y]=l.useState([]),[d,N]=l.useState([]),[D,f]=l.useState(!0),[u,F]=l.useState(""),[o,c]=l.useState("all"),[x,p]=l.useState({isOpen:!1,courseId:"",courseTitle:""}),[m,i]=l.useState(null);l.useEffect(()=>{v()},[]);const j=l.useCallback(()=>{let t=[...d];if(o!=="all"){const s=new Date;t=t.filter(a=>{const r=a.startDate?new Date(a.startDate):null,n=a.endDate?new Date(a.endDate):null;switch(o){case"featured":return!r||r>s;case"available":return!r||r>=s||r<=s&&(!n||n>=s);case"ongoing":return r&&r<=s&&(!n||n>=s);case"closed":return n&&n<s;default:return!0}})}if(u){const s=u.toLowerCase();t=t.filter(a=>a.title.toLowerCase().includes(s)||a.description?.toLowerCase().includes(s)||a.creator.name.toLowerCase().includes(s))}y(t)},[o,u,d]);l.useEffect(()=>{j()},[j]);const v=async()=>{try{f(!0);const t=await M("/courses");N(t)}catch{}finally{f(!1)}},C=t=>{if(v(),t?.enrollment){const s=t.enrollment.status;if(s==="WAITLIST"){const a=t.metadata?.waitlistPosition;i({message:a&&a>0?`Você entrou na lista de espera. Posição atual: ${a}.`:"Você entrou na lista de espera deste curso. Aguarde a aprovação do administrador.",tone:"info"})}else i(s==="PENDING_REGION"?{message:t.enrollment.eligibilityReason||"Cadastro registrado, aguardando confirmação da equipe.",tone:"warning"}:s==="REJECTED"?{message:t.enrollment.eligibilityReason||"Sua inscrição foi registrada, mas não pôde ser aprovada automaticamente.",tone:"warning"}:{message:'Inscrição confirmada! Você já pode acessar o conteúdo em "Meus Cursos".',tone:"success"})}else i({message:"Solicitação enviada. Verifique seus cursos em alguns instantes.",tone:"info"});setTimeout(()=>i(null),8e3)},k=t=>{const s=new Date,a=t.startDate?new Date(t.startDate):null,r=t.endDate?new Date(t.endDate):null;return r&&r<s?{label:"Encerrado",color:"bg-gray-500",badge:"Encerrado"}:a?a>s?{label:"Inscrições Abertas",color:"bg-green-500",badge:"Inscrições Abertas"}:a<=s&&(!r||r>=s)?{label:"Em Andamento",color:"bg-blue-500",badge:"Em Andamento"}:{label:"Disponível",color:"bg-green-500",badge:"Inscrições Abertas"}:{label:"Inscrições Abertas",color:"bg-green-500",badge:"Inscrições Abertas"}},g=t=>{const s=new Date;return d.filter(a=>{const r=a.startDate?new Date(a.startDate):null,n=a.endDate?new Date(a.endDate):null;switch(t){case"featured":return!r||r>s;case"available":return!r||r>=s||r<=s&&(!n||n>=s);case"ongoing":return r&&r<=s&&(!n||n>=s);case"closed":return n&&n<s;default:return!0}}).length};return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col",children:[e.jsx(I,{}),e.jsx("div",{className:"bg-white border-b",children:e.jsxs("div",{className:"container mx-auto px-4 py-6 space-y-4",children:[m&&e.jsx("div",{className:`rounded-lg border px-4 py-3 text-sm ${m.tone==="success"?"border-green-200 bg-green-50 text-green-800":m.tone==="warning"?"border-yellow-200 bg-yellow-50 text-yellow-800":"border-blue-200 bg-blue-50 text-blue-800"}`,children:m.message}),e.jsxs("div",{className:"relative max-w-2xl mx-auto",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{className:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",placeholder:"Pesquisar cursos por nome, descrição ou local...",value:u,onChange:t=>F(t.target.value),className:"block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#FF6600] focus:border-transparent text-gray-900"})]})]})}),e.jsx("div",{className:"bg-white border-b",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex flex-wrap gap-3 justify-center",children:[e.jsxs("button",{onClick:()=>c("all"),className:`px-4 py-2 rounded-full font-medium transition-colors ${o==="all"?"bg-[#FF6600] text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Todos os Cursos (",d.length,")"]}),e.jsxs("button",{onClick:()=>c("featured"),className:`px-4 py-2 rounded-full font-medium transition-colors ${o==="featured"?"bg-[#FF6600] text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Em Destaque (",g("featured"),")"]}),e.jsxs("button",{onClick:()=>c("available"),className:`px-4 py-2 rounded-full font-medium transition-colors ${o==="available"?"bg-[#FF6600] text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Disponíveis (",g("available"),")"]}),e.jsxs("button",{onClick:()=>c("ongoing"),className:`px-4 py-2 rounded-full font-medium transition-colors ${o==="ongoing"?"bg-[#FF6600] text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Em Andamento (",g("ongoing"),")"]}),e.jsxs("button",{onClick:()=>c("closed"),className:`px-4 py-2 rounded-full font-medium transition-colors ${o==="closed"?"bg-[#FF6600] text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Encerrados (",g("closed"),")"]})]})})}),e.jsx("div",{className:"container mx-auto px-4 py-8 flex-1",children:D?e.jsx("div",{className:"text-center py-24",children:e.jsx("div",{className:"text-xl text-gray-600",children:"Carregando cursos..."})}):b.length===0?e.jsxs("div",{className:"text-center py-24",children:[e.jsx("p",{className:"text-gray-500 text-lg mb-4",children:"Nenhum curso encontrado."}),e.jsx("p",{className:"text-gray-400",children:"Tente ajustar os filtros ou a busca."})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:b.map(t=>{const s=k(t),a=!t.startDate||new Date(t.startDate)>new Date,r=t._count.enrollments>0?Math.min(100,t._count.enrollments/50*100):0;return e.jsxs("div",{className:"relative bg-white rounded-lg shadow-md overflow-hidden hover:shadow-xl transition-shadow",children:[t.bannerUrl&&t.bannerUrl.trim()?e.jsxs("div",{className:"relative w-full h-[386px] overflow-hidden bg-gray-200",children:[e.jsx("img",{src:t.bannerUrl,alt:`Banner do curso ${t.title}`,className:"w-full h-full min-w-full min-h-full object-cover",style:{objectFit:"cover",objectPosition:"center"},onError:n=>{n.currentTarget.style.display="none"}}),e.jsx("div",{className:`absolute top-0 left-0 right-0 h-2 ${a?"bg-[#FF6600]":"bg-[#003366]"}`}),a&&e.jsx("div",{className:"absolute top-3 right-3 bg-[#FF6600] text-white text-xs px-2 py-1 rounded-full font-semibold shadow-lg",children:"Destaque"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`h-2 ${a?"bg-[#FF6600]":"bg-[#003366]"}`}),a&&e.jsx("div",{className:"absolute top-2 right-2 bg-[#FF6600] text-white text-xs px-2 py-1 rounded-full font-semibold",children:"Destaque"})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-3",children:e.jsx("span",{className:`${s.color} text-white text-xs px-2 py-1 rounded-full font-medium`,children:s.badge})}),e.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-2 line-clamp-2",children:t.title}),t.description&&e.jsx("p",{className:"text-gray-600 text-sm mb-4 line-clamp-3",children:t.description}),e.jsxs("div",{className:"space-y-2 mb-4 text-sm text-gray-600",children:[t.startDate&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("span",{children:T(new Date(t.startDate),"dd/MM/yyyy",{locale:$})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),e.jsx("span",{children:"Online"})]}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("span",{className:"text-gray-500",children:[t._count.enrollments,"/50 vagas ocupadas"]})}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-[#FF6600] h-2 rounded-full transition-all",style:{width:`${r}%`}})})]}),e.jsx("button",{onClick:()=>{h?p({isOpen:!0,courseId:t.id,courseTitle:t.title}):w("/login")},className:"block w-full bg-[#FF6600] text-white text-center py-3 rounded-md font-semibold hover:bg-[#e55a00] transition-colors",children:"Cadastrar-se no Curso"})]})]},t.id)})})}),e.jsx(A,{}),h&&e.jsx("div",{className:"md:hidden h-20"}),e.jsx(L,{isOpen:x.isOpen,onClose:()=>p({isOpen:!1,courseId:"",courseTitle:""}),courseId:x.courseId,courseTitle:x.courseTitle,onSuccess:C})]})}export{J as default};
