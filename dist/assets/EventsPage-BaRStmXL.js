import{j as e}from"./index-DV2PpVyR.js";import{u as K,d as r,L as R}from"./react-vendor-40RSlyA9.js";import{M as Q}from"./MobileNavbar-CmJd8mrT.js";import{F as X}from"./Footer-BzSJqgxO.js";import{a as f}from"./api-WS8dxZuR.js";import{u as Y}from"./useAuth-Dhb34Y_Y.js";import{f as Z}from"./utils-vendor-DwAQI6Fw.js";import{p as ee}from"./NotificationBell-B-BMmbjJ.js";import"./ui-vendor-CXsW6q1o.js";function ce(){const b=K(),{user:y,loading:j,isAuthenticated:N}=Y({requireAuth:!0,redirectTo:"/login"}),[v,$]=r.useState([]),[V,w]=r.useState(!0),[C,k]=r.useState(null),[x,O]=r.useState(""),[m,D]=r.useState("ALL"),[B,u]=r.useState(!1),[W,E]=r.useState(!1),[P,d]=r.useState("idle"),[o,H]=r.useState(null),[S,L]=r.useState(!1),[F,g]=r.useState(null),[n,c]=r.useState({title:"",description:"",bannerUrl:"",maxRegistrations:""});r.useEffect(()=>{j||(!N||y?.role!=="ADMIN"?b("/my-courses"):p())},[j,N,y,b]);async function p(){try{w(!0),k(null);const t=await f("/events",{auth:!0});$(t)}catch(t){k(t instanceof Error?t.message:"Erro ao carregar eventos")}finally{w(!1)}}const T=r.useMemo(()=>v.filter(t=>m==="ALL"?!0:t.status===m).filter(t=>{if(!x.trim())return!0;const s=x.toLowerCase();return t.title.toLowerCase().includes(s)||t.description.toLowerCase().includes(s)||t.linkId.toLowerCase().includes(s)}),[v,m,x]),A=t=>{const s=typeof window<"u"?window.location.origin:"",i=s?`${s}/register/${t.linkId}`:`/register/${t.linkId}`;let l=t.bannerUrl??void 0;return l&&l.startsWith("/")&&(l=s?`${s}${l}`:l),{url:i,bannerUrl:l,message:`Confira o link de cadastro "${t.title}" no Link de Cadastro: ${i}`}},a=r.useMemo(()=>o?A(o):null,[o]),q=()=>{g(null),c({title:"",description:"",bannerUrl:"",maxRegistrations:""}),u(!0)},I=()=>{u(!1)},z=t=>{H(t),d("idle"),E(!0)},M=()=>{E(!1)},J=async()=>{if(a)try{navigator.clipboard?.writeText&&(await navigator.clipboard.writeText(a.url),d("success"),setTimeout(()=>d("idle"),2e3))}catch{}},_=async()=>{if(!a||!o)return;const t={title:o.title,text:a.message,url:a.url};try{navigator.share?await navigator.share(t):navigator.clipboard?.writeText&&(await navigator.clipboard.writeText(a.message),d("success"),setTimeout(()=>d("idle"),2e3))}catch{}},U=t=>{const s=`https://wa.me/?text=${encodeURIComponent(t.message)}`;window.open(s,"_blank","noopener,noreferrer")},G=async t=>{t.preventDefault(),L(!0),g(null);try{const s={title:n.title,description:n.description};if(n.bannerUrl.trim()&&(s.bannerUrl=n.bannerUrl.trim()),n.maxRegistrations.trim()){const i=Number(n.maxRegistrations);if(Number.isNaN(i)||i<0)throw new Error("Informe um limite válido de vagas");s.maxRegistrations=i}await f("/events",{method:"POST",auth:!0,body:JSON.stringify(s)}),await p(),u(!1)}catch(s){g(s instanceof Error?s.message:"Erro ao criar evento")}finally{L(!1)}},h=async(t,s)=>{try{await f(`/admin/events/${t.id}`,{method:"PATCH",auth:!0,body:JSON.stringify({status:s})}),await p()}catch(i){alert(i instanceof Error?i.message:"Erro ao atualizar status")}};return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col",children:[e.jsx(Q,{}),e.jsx("main",{className:"flex-1",children:e.jsxs("div",{className:"container mx-auto px-4 py-6",children:[e.jsxs("div",{className:"mb-6 flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-[#003366]",children:"Histórico de Links"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Gerencie os links de cadastro criados para eventos e campanhas."})]}),e.jsxs("button",{onClick:q,className:"inline-flex items-center gap-2 rounded-lg bg-[#FF6600] px-4 py-2 text-sm font-semibold text-white transition-colors hover:bg-[#e55a00]",children:[e.jsx("span",{className:"text-lg",children:"+"}),"Novo link"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 md:p-6 space-y-4",children:[e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsx("div",{className:"flex flex-1 items-center gap-3",children:e.jsx("input",{type:"text",value:x,onChange:t=>O(t.target.value),placeholder:"Buscar por título, descrição ou link",className:"flex-1 rounded-lg border border-gray-300 px-4 py-2 text-sm focus:border-transparent focus:ring-2 focus:ring-[#FF6600]"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm text-gray-500",children:"Status:"}),e.jsxs("select",{value:m,onChange:t=>D(t.target.value),className:"rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-transparent focus:ring-2 focus:ring-[#FF6600]",children:[e.jsx("option",{value:"ALL",children:"Todos"}),e.jsx("option",{value:"ACTIVE",children:"Ativos"}),e.jsx("option",{value:"INACTIVE",children:"Inativos"}),e.jsx("option",{value:"CLOSED",children:"Encerrados"})]})]})]}),V?e.jsx("div",{className:"py-16 text-center text-gray-500",children:"Carregando links..."}):C?e.jsx("div",{className:"py-16 text-center text-red-500",children:C}):T.length===0?e.jsx("div",{className:"py-16 text-center text-gray-500",children:"Nenhum link encontrado."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-600",children:"Título"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-600",children:"Link"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-600",children:"Criado em"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-600",children:"Inscritos"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-600",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-600",children:"Ações"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:T.map(t=>{const s=A(t);return e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsxs("td",{className:"px-4 py-3 align-top",children:[e.jsx("div",{className:"font-semibold text-[#003366]",children:t.title}),e.jsx("div",{className:"text-xs text-gray-500 line-clamp-2",children:t.description})]}),e.jsx("td",{className:"px-4 py-3 align-top",children:e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsx("span",{className:"truncate max-w-[240px]",children:s.url}),e.jsx("button",{onClick:async()=>{try{navigator.clipboard?.writeText&&(await navigator.clipboard.writeText(s.url),alert("Link copiado!"))}catch{}},className:"rounded-md border border-gray-300 px-2 py-1 text-xs font-medium text-gray-600 transition-colors hover:bg-gray-100",children:"Copiar"})]})}),e.jsx("td",{className:"px-4 py-3 align-top text-xs text-gray-600",children:Z(new Date(t.createdAt),"dd/MM/yyyy HH:mm",{locale:ee})}),e.jsx("td",{className:"px-4 py-3 align-top text-xs text-gray-600",children:t._count?.registrations??0}),e.jsx("td",{className:"px-4 py-3 align-top",children:e.jsx("span",{className:`inline-flex items-center rounded-full px-3 py-1 text-xs font-semibold ${t.status==="ACTIVE"?"bg-green-100 text-green-700":t.status==="INACTIVE"?"bg-gray-100 text-gray-700":"bg-red-100 text-red-700"}`,children:t.status==="ACTIVE"?"Ativo":t.status==="INACTIVE"?"Inativo":"Encerrado"})}),e.jsx("td",{className:"px-4 py-3 align-top",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(R,{to:`/admin/events/${t.id}/registrations`,className:"rounded-md bg-[#FF6600] px-3 py-1 text-xs font-semibold text-white transition-colors hover:bg-[#e55a00] text-center",children:"Ver Registros"}),e.jsx(R,{to:`/admin/events/${t.id}/classes`,className:"rounded-md bg-[#003366] px-3 py-1 text-xs font-semibold text-white transition-colors hover:bg-[#00264d] text-center",children:"Ver Turmas"}),e.jsx("button",{onClick:()=>z(t),className:"rounded-md bg-[#003366] px-3 py-1 text-xs font-semibold text-white transition-colors hover:bg-[#00264d]",children:"Compartilhar"}),e.jsx("button",{onClick:()=>U(s),className:"rounded-md bg-green-600 px-3 py-1 text-xs font-semibold text-white transition-colors hover:bg-green-700",children:"WhatsApp"}),t.status!=="ACTIVE"&&e.jsx("button",{onClick:()=>h(t,"ACTIVE"),className:"rounded-md border border-[#FF6600] px-3 py-1 text-xs font-semibold text-[#FF6600] transition-colors hover:bg-orange-50",children:"Ativar"}),t.status==="ACTIVE"&&e.jsx("button",{onClick:()=>h(t,"INACTIVE"),className:"rounded-md border border-gray-300 px-3 py-1 text-xs font-semibold text-gray-600 transition-colors hover:bg-gray-100",children:"Inativar"}),t.status!=="CLOSED"&&e.jsx("button",{onClick:()=>h(t,"CLOSED"),className:"rounded-md border border-red-500 px-3 py-1 text-xs font-semibold text-red-500 transition-colors hover:bg-red-50",children:"Encerrar"})]})})]},t.id)})})]})})]})]})}),e.jsx(X,{}),B&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 px-4 py-6",children:e.jsxs("div",{className:"w-full max-w-2xl rounded-2xl bg-white shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between border-b px-6 py-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-[#003366]",children:"Criar novo link"}),e.jsx("button",{onClick:I,className:"text-gray-400 transition-colors hover:text-gray-600",children:e.jsx("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("form",{onSubmit:G,className:"space-y-4 px-6 py-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Título *"}),e.jsx("input",{type:"text",value:n.title,onChange:t=>c(s=>({...s,title:t.target.value})),required:!0,className:"mt-1 w-full rounded-lg border border-gray-300 px-4 py-2 text-sm focus:border-transparent focus:ring-2 focus:ring-[#FF6600]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Descrição *"}),e.jsx("textarea",{value:n.description,onChange:t=>c(s=>({...s,description:t.target.value})),required:!0,rows:3,className:"mt-1 w-full rounded-lg border border-gray-300 px-4 py-2 text-sm focus:border-transparent focus:ring-2 focus:ring-[#FF6600]"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Banner (URL)"}),e.jsx("input",{type:"url",value:n.bannerUrl,onChange:t=>c(s=>({...s,bannerUrl:t.target.value})),placeholder:"https://...",className:"mt-1 w-full rounded-lg border border-gray-300 px-4 py-2 text-sm focus:border-transparent focus:ring-2 focus:ring-[#FF6600]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Limite de vagas (opcional)"}),e.jsx("input",{type:"number",min:0,value:n.maxRegistrations,onChange:t=>c(s=>({...s,maxRegistrations:t.target.value})),placeholder:"Ex: 100",className:"mt-1 w-full rounded-lg border border-gray-300 px-4 py-2 text-sm focus:border-transparent focus:ring-2 focus:ring-[#FF6600]"})]})]}),F&&e.jsx("p",{className:"text-sm text-red-500",children:F}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:I,className:"rounded-lg border border-gray-300 px-4 py-2 text-sm font-semibold text-gray-600 transition-colors hover:bg-gray-100",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:S,className:"rounded-lg bg-[#FF6600] px-4 py-2 text-sm font-semibold text-white transition-colors hover:bg-[#e55a00] disabled:cursor-not-allowed disabled:opacity-60",children:S?"Criando...":"Criar link"})]})]})]})}),W&&o&&a&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 px-4 py-6",children:e.jsxs("div",{className:"w-full max-w-xl rounded-2xl bg-white shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between border-b px-6 py-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-[#003366]",children:"Compartilhar link"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Revise as informações antes de enviar"})]}),e.jsx("button",{onClick:M,className:"text-gray-400 transition-colors hover:text-gray-600",children:e.jsx("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"grid gap-4 px-6 py-4 md:grid-cols-[160px,1fr]",children:[e.jsx("div",{className:"flex items-center justify-center",children:a.bannerUrl?e.jsx("img",{src:a.bannerUrl,alt:`Banner do evento ${o.title}`,className:"h-32 w-32 rounded-lg object-cover shadow-sm",referrerPolicy:"no-referrer"}):e.jsx("div",{className:"flex h-32 w-32 items-center justify-center rounded-lg bg-gradient-to-br from-[#003366] to-[#FF6600] text-center text-xs font-semibold text-white",children:"Sem banner"})}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-[#003366]",children:o.title}),e.jsx("p",{className:"mt-1 text-sm text-gray-600 line-clamp-3",children:o.description})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500",children:"Link do evento"}),e.jsxs("div",{className:"mt-1 grid grid-cols-[1fr,auto] gap-2 overflow-hidden rounded-lg border border-gray-200 bg-gray-50",children:[e.jsx("input",{readOnly:!0,value:a.url,className:"truncate bg-transparent px-3 py-2 text-sm text-gray-700 outline-none"}),e.jsx("button",{onClick:J,className:"m-1 flex items-center justify-center rounded-md bg-white px-3 text-xs font-semibold text-[#003366] transition-colors hover:bg-gray-100",children:P==="success"?"Copiado!":"Copiar"})]})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-3 border-t bg-gray-50 px-6 py-4 md:flex-row md:justify-end",children:[e.jsx("button",{onClick:_,className:"inline-flex items-center justify-center gap-2 rounded-lg bg-[#003366] px-4 py-2 text-sm font-semibold text-white transition-colors hover:bg-[#00264d]",children:"Compartilhar agora"}),e.jsx("button",{onClick:()=>a&&U(a),className:"inline-flex items-center justify-center gap-2 rounded-lg bg-green-600 px-4 py-2 text-sm font-semibold text-white transition-colors hover:bg-green-700",children:"WhatsApp"}),e.jsx("button",{onClick:M,className:"inline-flex items-center justify-center gap-2 rounded-lg border border-gray-300 px-4 py-2 text-sm font-semibold text-gray-600 transition-colors hover:bg-gray-100",children:"Fechar"})]})]})})]})}export{ce as default};
