import{u as L,j as e,L as z}from"./index-CsxD5A8A.js";import{u as P,d as m,L as F}from"./react-vendor-40RSlyA9.js";import{u as B,o as D,s as l,e as M,l as O}from"./form-vendor-UKDbifrO.js";import{t as W}from"./zod-Bd6eNPbn.js";import{M as $}from"./MobileNavbar-Df5BYSkg.js";import{N as q}from"./NotificationBell-ZfODFpwn.js";import{F as G}from"./Footer-Cs2AOzBe.js";import{g as J,a as H}from"./api-cc_Vofyw.js";import"./ui-vendor-VWVTWWFz.js";import"./utils-vendor-DwAQI6Fw.js";const K=D({title:l().min(1,"Título é obrigatório"),description:l().min(1,"Descrição é obrigatória"),bannerUrl:l().optional().or(O("")).transform(s=>s&&s.trim()?s.trim():void 0).refine(s=>!s||s.startsWith("/")||s.startsWith("http://")||s.startsWith("https://"),{message:"URL inválida"}),status:M(["ACTIVE","INACTIVE"]).default("ACTIVE"),maxRegistrations:l().optional().transform(s=>{if(!s||!s.trim())return null;const i=parseInt(s,10);return Number.isNaN(i)?null:i}),slug:l().optional().transform(s=>{if(!(!s||typeof s!="string"||!s.trim()))return s.trim().toLowerCase()}).refine(s=>!s||/^[a-z0-9-]+$/.test(s),{message:"URL personalizada deve conter apenas letras minúsculas, números e hífens"})});function ne(){const s=P(),{user:i,loading:E,isAuthenticated:U,signOut:S}=L({requireAuth:!0,redirectTo:"/login"}),[x,p]=m.useState(!1),[g,d]=m.useState(null),[h,b]=m.useState(!1),[c,f]=m.useState(null),{register:o,handleSubmit:A,watch:T,setValue:y,formState:{errors:t}}=B({resolver:W(K),defaultValues:{status:"ACTIVE"}}),j=T("bannerUrl"),C=async r=>{b(!0),d(null);try{if(!r.type.startsWith("image/"))throw new Error("Apenas imagens são permitidas (JPG, PNG, GIF)");const a=5*1024*1024;if(r.size>a)throw new Error(`Arquivo muito grande (${(r.size/1024/1024).toFixed(2)}MB). Máximo: 5MB`);const n=new FormData;n.append("file",r);const N=`${J()}/admin/upload`,k=typeof window<"u"?localStorage.getItem("token"):null,u=await fetch(N,{method:"POST",headers:{Authorization:`Bearer ${k}`},body:n});if(!u.ok){const V=await u.json().catch(()=>({}));throw new Error(V.message||"Erro ao fazer upload da imagem")}const v=await u.json(),w=v.url||v.path;y("bannerUrl",w,{shouldValidate:!0}),f(w)}catch(a){const n=a?.message||"Erro ao fazer upload da imagem";d(n)}finally{b(!1)}},I=r=>{y("bannerUrl",r,{shouldValidate:!0}),f(r)},R=async r=>{p(!0),d(null);try{const a=r.bannerUrl&&r.bannerUrl.trim()||c&&c.trim()||void 0,n={title:r.title,description:r.description,bannerUrl:a,status:r.status||"ACTIVE",maxRegistrations:r.maxRegistrations&&typeof r.maxRegistrations=="number"?r.maxRegistrations:null,slug:r.slug||void 0},N=await H("/events",{method:"POST",auth:!0,body:JSON.stringify(n)});s("/admin/events")}catch(a){const n=a?.message||"Erro ao criar evento";d(n)}finally{p(!1)}};return E?e.jsx(z,{}):!U||i?.role!=="ADMIN"?null:e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col",children:[e.jsx($,{user:i,onSignOut:S}),e.jsx(q,{}),e.jsx("main",{className:"flex-1",children:e.jsxs("div",{className:"container mx-auto px-4 py-8 pb-24 md:pb-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx(F,{to:"/admin/events",className:"text-[#FF6600] hover:underline mb-4 inline-block",children:"← Voltar para Eventos"}),e.jsx("h1",{className:"text-3xl font-bold text-[#003366] mb-2",children:"Criar Novo Evento"}),e.jsx("p",{className:"text-gray-600",children:"Preencha os dados abaixo para criar um novo evento"})]}),g&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg text-red-700",children:g}),e.jsxs("form",{onSubmit:A(R),className:"bg-white rounded-lg shadow-md p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Título *"}),e.jsx("input",{type:"text",...o("title"),className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#FF6600] focus:border-transparent text-gray-900",placeholder:"Ex: Workshop de Aquicultura"}),t.title&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:t.title.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descrição *"}),e.jsx("textarea",{...o("description"),rows:4,className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#FF6600] focus:border-transparent text-gray-900",placeholder:"Descreva o evento..."}),t.description&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:t.description.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"URL Personalizada (opcional)"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-500",children:"https://seudominio.com/e/"}),e.jsx("input",{type:"text",...o("slug"),placeholder:"meu-evento-especial",className:"flex-1 px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#FF6600] focus:border-transparent text-gray-900"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Use apenas letras minúsculas, números e hífens. Ex: meu-evento-especial"}),t.slug&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:t.slug.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status *"}),e.jsxs("select",{...o("status"),className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#FF6600] focus:border-transparent text-gray-900",children:[e.jsx("option",{value:"ACTIVE",children:"Ativo"}),e.jsx("option",{value:"INACTIVE",children:"Inativo"})]}),t.status&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:t.status.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Limite de Registros (opcional)"}),e.jsx("input",{type:"number",min:"0",...o("maxRegistrations"),className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#FF6600] focus:border-transparent text-gray-900",placeholder:"Ex: 100"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Deixe em branco para sem limite"}),t.maxRegistrations&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:t.maxRegistrations.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Banner (URL ou Upload)"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"url",...o("bannerUrl"),className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#FF6600] focus:border-transparent text-gray-900",placeholder:"https://...",onChange:r=>I(r.target.value)}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-500 text-sm",children:"ou"}),e.jsxs("label",{className:"cursor-pointer",children:[e.jsx("span",{className:"inline-flex items-center px-4 py-2 bg-[#FF6600] text-white rounded-md hover:bg-[#e55a00] transition-colors",children:h?"Enviando...":"Fazer Upload"}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:r=>{const a=r.target.files?.[0];a&&C(a)},disabled:h})]})]})]}),t.bannerUrl&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:t.bannerUrl.message}),(j||c)&&e.jsx("div",{className:"mt-4",children:e.jsx("img",{src:j||c||"",alt:"Preview do banner",className:"max-w-full h-48 object-cover rounded-md border border-gray-300",onError:r=>{r.currentTarget.style.display="none"}})})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t",children:[e.jsx(F,{to:"/admin/events",className:"px-6 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:x,className:"px-6 py-2 bg-[#FF6600] text-white rounded-md hover:bg-[#e55a00] transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:x?"Criando...":"Criar Evento"})]})]})]})}),e.jsx(G,{})]})}export{ne as default};
