import{u as S,j as e,L as $}from"./index-DHiB8Icf.js";import{u as B,d as i,L as d}from"./react-vendor-40RSlyA9.js";import{M as P}from"./MobileNavbar-DcONV8u5.js";import{F as W}from"./Footer-CwOlXCR5.js";import{a as p}from"./api-cc_Vofyw.js";import{f as E}from"./utils-vendor-DwAQI6Fw.js";import{p as k}from"./NotificationBell-BFHzVvAE.js";import"./ui-vendor-VWVTWWFz.js";function O(){const j=B(),{user:x,loading:h,isAuthenticated:f}=S({requireAuth:!0,redirectTo:"/login"}),[r,A]=i.useState(null),[u,D]=i.useState([]),[N,T]=i.useState([]),[L,g]=i.useState(!0),[y,w]=i.useState(null),[v,I]=i.useState(""),[o,c]=i.useState("all"),C=i.useCallback(async()=>{try{const[s,t]=await Promise.all([p("/admin/courses",{auth:!0}),p("/events",{auth:!0})]);D(s);const l=s.reduce((a,n)=>a+(n._count?.enrollments||0),0);A({totalCourses:s.length,totalEvents:t.length,activeCourses:s.filter(a=>a.status==="ACTIVE").length,inactiveCourses:s.filter(a=>a.status==="INACTIVE").length,activeEvents:t.filter(a=>a.status==="ACTIVE").length,totalEnrollments:l}),await M(s)}catch(s){console.error("Erro ao buscar estatísticas:",s);const t=s instanceof Error?s.message:"Erro ao carregar dados do dashboard";w(t),g(!1)}finally{g(!1)}},[]);i.useEffect(()=>{if(!h){if(!f||x?.role!=="ADMIN"){j("/my-courses");return}C()}},[h,f,x,j]);async function M(s){try{const t=s.slice(0,5).map(m=>p(`/admin/courses/${m.id}/enrollments`,{auth:!0}).then(b=>b.map(V=>({...V,courseTitle:m.title}))).catch(()=>[])),n=(await Promise.all(t)).flat().sort((m,b)=>new Date(b.createdAt).getTime()-new Date(m.createdAt).getTime()).slice(0,10);T(n)}catch(t){console.error("Erro ao buscar inscrições recentes:",t)}}const F=(()=>{let s=[...u];if(o!=="all"){const t=new Date;s=s.filter(l=>{const a=l.startDate?new Date(l.startDate):null,n=l.endDate?new Date(l.endDate):null;switch(o){case"active":return l.status==="ACTIVE";case"inactive":return l.status==="INACTIVE";case"available":return!a||a>=t||a<=t&&(!n||n>=t);case"ongoing":return a&&a<=t&&(!n||n>=t);case"closed":return n&&n<t;default:return!0}})}if(v){const t=v.toLowerCase();s=s.filter(l=>l.title.toLowerCase().includes(t)||l.description?.toLowerCase().includes(t))}return s})();return h||L?e.jsx($,{}):y?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center p-8",children:[e.jsx("h1",{className:"text-2xl font-bold text-red-600 mb-4",children:"Erro ao carregar dashboard"}),e.jsx("p",{className:"text-gray-600 mb-4",children:y}),e.jsx("button",{onClick:()=>{w(null),g(!0),C()},className:"bg-[#FF6600] text-white px-6 py-3 rounded-md font-semibold hover:bg-[#e55a00] transition-colors",children:"Tentar novamente"})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col",children:[e.jsx(P,{}),e.jsx("div",{className:"bg-white border-b",children:e.jsx("div",{className:"container mx-auto px-4 py-6",children:e.jsxs("div",{className:"relative max-w-2xl mx-auto",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{className:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",placeholder:"Pesquisar cursos por nome, descrição...",value:v,onChange:s=>I(s.target.value),className:"block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#FF6600] focus:border-transparent text-gray-900"})]})})}),e.jsx("div",{className:"bg-white border-b",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex flex-wrap gap-3 justify-center",children:[e.jsxs("button",{onClick:()=>c("all"),className:`px-4 py-2 rounded-full font-medium transition-colors ${o==="all"?"bg-[#FF6600] text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Todos (",u.length,")"]}),e.jsxs("button",{onClick:()=>c("active"),className:`px-4 py-2 rounded-full font-medium transition-colors ${o==="active"?"bg-[#FF6600] text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Ativos (",r?.activeCourses||0,")"]}),e.jsxs("button",{onClick:()=>c("inactive"),className:`px-4 py-2 rounded-full font-medium transition-colors ${o==="inactive"?"bg-[#FF6600] text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Inativos (",r?.inactiveCourses||0,")"]}),e.jsx("button",{onClick:()=>c("available"),className:`px-4 py-2 rounded-full font-medium transition-colors ${o==="available"?"bg-[#FF6600] text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Disponíveis"}),e.jsx("button",{onClick:()=>c("ongoing"),className:`px-4 py-2 rounded-full font-medium transition-colors ${o==="ongoing"?"bg-[#FF6600] text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Em Andamento"}),e.jsx("button",{onClick:()=>c("closed"),className:`px-4 py-2 rounded-full font-medium transition-colors ${o==="closed"?"bg-[#FF6600] text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Encerrados"})]})})}),e.jsxs("div",{className:"container mx-auto px-4 py-8 pb-24 md:pb-8 flex-1",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-[#003366] mb-2",children:"Painel de Controle"}),e.jsx("p",{className:"text-gray-600",children:"Gerenciamento e moderação de conteúdos"})]}),r&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-8",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 border-l-4 border-[#FF6600]",children:[e.jsx("div",{className:"text-2xl font-bold text-[#FF6600] mb-1",children:r.totalCourses}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total de Cursos"}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[r.activeCourses," ativos • ",r.inactiveCourses," inativos"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 border-l-4 border-blue-500",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-500 mb-1",children:r.totalEnrollments||0}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total de Inscrições"}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[u.reduce((s,t)=>s+(t._count?.enrollments||0),0)," alunos"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 border-l-4 border-green-500",children:[e.jsx("div",{className:"text-2xl font-bold text-green-500 mb-1",children:r.activeCourses}),e.jsx("div",{className:"text-sm text-gray-600",children:"Cursos Ativos"}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[(r.activeCourses/r.totalCourses*100||0).toFixed(0),"% do total"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 border-l-4 border-purple-500",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-500 mb-1",children:r.totalEvents}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total de Eventos"}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[r.activeEvents," ativos"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:[e.jsxs(d,{to:"/admin/courses/new",className:"bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow border-l-4 border-[#FF6600]",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("svg",{className:"w-8 h-8 text-[#FF6600]",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),e.jsx("h2",{className:"text-lg font-semibold text-[#003366]",children:"Criar Curso"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Adicionar novo curso à plataforma"})]}),e.jsxs(d,{to:"/admin/whatsapp/send",className:"bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow border-l-4 border-green-500",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("svg",{className:"w-8 h-8 text-green-500",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"})}),e.jsx("h2",{className:"text-lg font-semibold text-[#003366]",children:"Enviar WhatsApp"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Compartilhar cursos ou eventos via WhatsApp"})]}),e.jsxs(d,{to:"/admin/courses",className:"bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow border-l-4 border-blue-500",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("svg",{className:"w-8 h-8 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})}),e.jsx("h2",{className:"text-lg font-semibold text-[#003366]",children:"Gerenciar Cursos"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Visualizar e editar cursos existentes"})]}),e.jsxs(d,{to:"/admin/events",className:"bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow border-l-4 border-green-500",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("svg",{className:"w-8 h-8 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("h2",{className:"text-lg font-semibold text-[#003366]",children:"Gerenciar Eventos"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Visualizar e editar eventos existentes"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-[#003366]",children:"Cursos Disponíveis"}),e.jsx(d,{to:"/admin/courses",className:"text-sm text-[#FF6600] hover:underline font-medium",children:"Ver todos →"})]}),F.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-500 text-lg mb-4",children:"Nenhum curso encontrado."}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Tente ajustar os filtros ou a busca."})]}):e.jsx("div",{className:"space-y-3",children:F.slice(0,5).map(s=>e.jsx("div",{className:"p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"font-semibold text-[#003366]",children:s.title}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${s.status==="ACTIVE"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:s.status==="ACTIVE"?"Ativo":"Inativo"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500 mb-2",children:[e.jsxs("span",{children:[s.lessons?.length||0," aulas"]}),e.jsxs("span",{children:[s._count?.enrollments||0," alunos"]}),s.startDate&&e.jsx("span",{children:E(new Date(s.startDate),"dd/MM/yyyy",{locale:k})})]}),s.description&&e.jsx("p",{className:"text-sm text-gray-600 line-clamp-2",children:s.description})]}),e.jsx("div",{className:"flex items-center gap-2 ml-4",children:e.jsx(d,{to:`/admin/courses/${s.id}/lessons`,className:"px-3 py-1 bg-[#FF6600] text-white text-sm rounded-md hover:bg-[#e55a00] transition-colors",children:"Gerenciar"})})]})},s.id))})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-[#003366]",children:"Inscrições Recentes"}),e.jsx(d,{to:"/admin/courses",className:"text-sm text-[#FF6600] hover:underline font-medium",children:"Ver todas →"})]}),N.length===0?e.jsx("p",{className:"text-gray-500 text-center py-8",children:"Nenhuma inscrição recente."}):e.jsx("div",{className:"space-y-3",children:N.map(s=>e.jsxs("div",{className:"p-4 border border-gray-200 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-[#003366]",children:s.user.name}),e.jsx("p",{className:"text-sm text-gray-500",children:s.user.email})]}),e.jsx("span",{className:"text-xs text-gray-500",children:E(new Date(s.createdAt),"dd/MM/yyyy HH:mm",{locale:k})})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:s.courseTitle}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-[#FF6600] h-2 rounded-full transition-all",style:{width:`${s.progress}%`}})}),e.jsxs("span",{className:"text-xs text-gray-600",children:[s.progress,"%"]})]})]})]},s.id))})]})]}),e.jsx(W,{}),x&&e.jsx("div",{className:"md:hidden h-20"})]})}export{O as default};
