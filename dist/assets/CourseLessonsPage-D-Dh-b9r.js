import{j as e,L as X}from"./index-CKd_6dCy.js";import{i as Z,u as ee,d as s,L as h}from"./react-vendor-40RSlyA9.js";import{u as re,o as te,n as ae,s as g,l as se}from"./form-vendor-UKDbifrO.js";import{t as oe}from"./zod-Bd6eNPbn.js";import{N as ne}from"./NotificationBell-B3QQdthT.js";import{F as le}from"./Footer-CrxvJtYf.js";import{a as c,g as ie}from"./api-WS8dxZuR.js";import{u as de}from"./useAuth-Dhb34Y_Y.js";import"./ui-vendor-CXsW6q1o.js";import"./utils-vendor-DwAQI6Fw.js";const ce=te({title:g().min(1,"T√≠tulo √© obrigat√≥rio"),description:g().optional(),videoUrl:g().url("URL do YouTube inv√°lida"),bannerUrl:g().optional().or(se("")).refine(d=>!d||d.trim()===""?!0:d.startsWith("/")||d.startsWith("http://")||d.startsWith("https://"),{message:"URL inv√°lida"}),duration:g().optional(),order:ae().int().min(0)});function ve(){const d=Z(),A=ee(),{user:F,loading:U,isAuthenticated:S,signOut:W}=de({requireAuth:!0,redirectTo:"/login"}),o=d.courseId,[C,T]=s.useState(null),[E,J]=s.useState([]),[k,y]=s.useState(!1),[b,j]=s.useState(null),[L,z]=s.useState(!1),[$,u]=s.useState(null),[D,V]=s.useState(!1),[O,n]=s.useState(null),{register:m,handleSubmit:_,formState:{errors:l},reset:p,setValue:a,watch:P}=re({resolver:oe(ce),defaultValues:{order:0}}),v=P("videoUrl"),f=P("bannerUrl"),q=r=>{const t=[/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([^&\n?#]+)/,/youtube\.com\/watch\?.*v=([^&\n?#]+)/];for(const i of t){const x=r.match(i);if(x&&x[1])return`https://img.youtube.com/vi/${x[1]}/maxresdefault.jpg`}return null};s.useEffect(()=>{if(v&&v.trim()){const r=q(v);r&&(!f||f==="")&&(a("bannerUrl",r,{shouldValidate:!1}),n(r))}},[v,f,a]);const G=async r=>{V(!0),u(null);try{if(!r.type.startsWith("image/"))throw new Error("Apenas imagens s√£o permitidas");const t=5*1024*1024;if(r.size>t)throw new Error("Arquivo muito grande. M√°ximo: 5MB");const i=new FormData;i.append("file",r);const x=typeof window<"u"?localStorage.getItem("token"):null,w=await fetch(`${ie()}/admin/upload`,{method:"POST",headers:x?{Authorization:`Bearer ${x}`}:void 0,body:i});if(!w.ok){let I="Erro ao fazer upload";try{const M=await w.json();M?.error&&(I=M.error)}catch{}throw new Error(I)}const Y=await w.json();a("bannerUrl",Y.url,{shouldValidate:!0}),n(Y.url)}catch(t){u(t instanceof Error?t.message:"Erro ao fazer upload")}finally{V(!1)}},B=s.useCallback(async()=>{try{const r=await c(`/admin/courses/${o}`,{auth:!0});T(r)}catch{}},[o]),N=s.useCallback(async()=>{try{const r=await c(`/admin/courses/${o}/lessons`,{auth:!0});J(r),p({order:r.length})}catch{}},[o,p]);s.useEffect(()=>{U||(!S||F?.role!=="ADMIN"?A("/my-courses"):o&&(B(),N()))},[U,S,F,o,B,N,A]);const H=async r=>{z(!0),u(null);try{b?await c(`/admin/courses/${o}/lessons/${b}`,{method:"PUT",auth:!0,body:JSON.stringify(r)}):await c(`/admin/courses/${o}/lessons`,{method:"POST",auth:!0,body:JSON.stringify(r)}),p(),y(!1),j(null),n(null),N()}catch(t){u(t instanceof Error?t.message:"Erro ao salvar aula")}finally{z(!1)}},K=async r=>{try{const t=await c(`/admin/courses/${o}/lessons/${r}`,{auth:!0});a("title",t.title),a("description",t.description||""),a("videoUrl",t.videoUrl),a("bannerUrl",t.bannerUrl||""),a("duration",t.duration||""),a("order",t.order),j(r),n(t.bannerUrl||null),y(!0),window.scrollTo({top:0,behavior:"smooth"})}catch{u("Erro ao carregar aula para edi√ß√£o")}},Q=async r=>{if(confirm("Tem certeza que deseja excluir esta aula?"))try{await c(`/admin/courses/${o}/lessons/${r}`,{method:"DELETE",auth:!0}),N()}catch(t){u(t instanceof Error?t.message:"Erro ao excluir aula")}},R=()=>{p(),y(!1),j(null),n(null)};return U||!C?e.jsx(X,{}):e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col",children:[e.jsx("header",{className:"bg-white shadow-sm sticky top-0 z-50",children:e.jsx("div",{className:"container mx-auto px-4 py-2",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between space-y-2 md:space-y-0",children:[e.jsx(h,{to:"/",className:"flex items-center",children:e.jsx("img",{src:"/logo B.png",alt:"Link de Cadastro",className:"h-20 md:h-24 w-auto object-contain"})}),e.jsxs("nav",{className:"flex items-center space-x-4 md:space-x-6 text-sm md:text-base",children:[e.jsx(h,{to:"/admin/dashboard",className:"text-gray-700 hover:text-[#FF6600]",children:"Dashboard"}),e.jsx(h,{to:"/admin/courses",className:"text-gray-700 hover:text-[#FF6600]",children:"Cursos"}),e.jsx(h,{to:"/admin/events",className:"text-gray-700 hover:text-[#FF6600]",children:"Eventos"}),e.jsx(ne,{}),e.jsx(h,{to:"/profile",className:"w-8 h-8 md:w-10 md:h-10 rounded-full bg-[#FF6600] text-white font-bold flex items-center justify-center",children:F?.name?.charAt(0).toUpperCase()||"A"}),e.jsx("button",{onClick:()=>W(),className:"bg-red-500 text-white px-4 py-2 rounded-md font-semibold hover:bg-red-600 transition-colors text-sm md:text-base",children:"Sair"})]})]})})}),e.jsxs("div",{className:"container mx-auto px-4 py-8 pb-24 md:pb-8 flex-1",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx(h,{to:"/admin/courses",className:"text-[#FF6600] hover:underline mb-4 inline-block",children:"‚Üê Voltar para Cursos"}),e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-[#003366]",children:C?.title||"Carregando..."}),e.jsx("p",{className:"text-gray-600 mt-2",children:C?.description})]}),e.jsx("button",{onClick:async()=>{const r=prompt("Digite a URL do banner do curso (ou deixe vazio para remover):");if(r!==null)try{const t=await c(`/admin/courses/${o}`,{method:"PUT",auth:!0,body:JSON.stringify({bannerUrl:r.trim()||null})});T(t),alert("Banner do curso atualizado com sucesso!"),window.location.reload()}catch(t){alert(t instanceof Error?t.message:"Erro ao atualizar banner")}},className:"bg-blue-600 text-white px-4 py-2 rounded-md font-semibold hover:bg-blue-700 transition-colors text-sm",children:"üì∏ Atualizar Banner do Curso"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-[#003366]",children:"Aulas do Curso"}),e.jsx("button",{onClick:()=>{k?R():(y(!0),j(null),p({order:E.length}))},className:"bg-[#FF6600] text-white px-4 py-2 rounded-md hover:bg-[#e55a00] transition-colors",children:k?"Cancelar":"+ Adicionar Aula"})]}),k&&e.jsxs("form",{onSubmit:_(H),className:"space-y-4 mb-6 p-4 bg-gray-50 rounded-lg",children:[b&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 text-blue-700 px-4 py-2 rounded mb-4",children:[e.jsx("strong",{children:"Editando aula:"}),' Voc√™ est√° editando uma aula existente. As altera√ß√µes ser√£o salvas quando voc√™ clicar em "Salvar Aula".']}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"T√≠tulo da Aula *"}),e.jsx("input",{...m("title"),className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#FF6600] focus:border-transparent text-gray-900"}),l.title&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l.title.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-red-600",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"})}),"Link do V√≠deo do YouTube *"]})}),e.jsx("input",{type:"text",...m("videoUrl"),placeholder:"Cole aqui o link do YouTube (ex: https://www.youtube.com/watch?v=... ou https://youtu.be/...)",className:"w-full px-4 py-3 border-2 border-gray-300 rounded-md focus:ring-2 focus:ring-[#FF6600] focus:border-[#FF6600] text-gray-900",onChange:r=>{const t=r.target.value;if(a("videoUrl",t,{shouldValidate:!1}),t&&t.trim()){const i=q(t);i&&(!f||f==="")&&(a("bannerUrl",i,{shouldValidate:!1}),n(i))}}}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Aceita links do YouTube em qualquer formato: youtube.com/watch?v=..., youtu.be/..., ou youtube.com/embed/..."}),l.videoUrl&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l.videoUrl.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Banner/Thumbnail da Aula (opcional)"}),e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"O banner ser√° extra√≠do automaticamente do YouTube quando voc√™ inserir o link do v√≠deo. Ou voc√™ pode fazer upload de uma imagem personalizada."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("input",{type:"file",accept:"image/*",onChange:r=>{const t=r.target.files?.[0];t&&G(t)},disabled:D,className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#FF6600] focus:border-transparent text-gray-900 disabled:opacity-50"}),D&&e.jsx("p",{className:"text-sm text-blue-600 mt-1",children:"Fazendo upload..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Ou informe a URL do banner:"}),e.jsx("input",{type:"text",...m("bannerUrl"),placeholder:"URL do banner/thumbnail (ex: https://exemplo.com/banner.jpg ou /uploads/banners/banner.jpg)",className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#FF6600] focus:border-transparent text-gray-900",onChange:r=>{const t=r.target.value.trim();a("bannerUrl",t,{shouldValidate:!1}),n(t||null)}})]}),O&&e.jsxs("div",{className:"mt-3",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Preview do banner:"}),e.jsx("div",{className:"relative w-full h-48 border border-gray-300 rounded-md overflow-hidden",children:e.jsx("img",{src:O,alt:"Preview do banner",className:"w-full h-full object-cover",onError:()=>n(null)})}),e.jsx("button",{type:"button",onClick:()=>{a("bannerUrl",""),n(null)},className:"mt-2 text-sm text-red-600 hover:text-red-800",children:"Remover banner"})]})]}),l.bannerUrl&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l.bannerUrl.message})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Dura√ß√£o (opcional)"}),e.jsx("input",{...m("duration"),placeholder:"Ex: 25:30",className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#FF6600] focus:border-transparent text-gray-900"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ordem *"}),e.jsx("input",{type:"number",...m("order",{valueAsNumber:!0}),className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#FF6600] focus:border-transparent text-gray-900"}),l.order&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l.order.message})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descri√ß√£o (opcional)"}),e.jsx("textarea",{...m("description"),rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#FF6600] focus:border-transparent text-gray-900"})]}),$&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded",children:$}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",disabled:L,className:"flex-1 bg-[#FF6600] text-white py-2 px-4 rounded-md font-semibold hover:bg-[#e55a00] transition-colors disabled:opacity-50",children:L?b?"Salvando...":"Adicionando...":b?"Salvar Aula":"Adicionar Aula"}),e.jsx("button",{type:"button",onClick:R,className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancelar"})]})]}),e.jsxs("div",{className:"space-y-2",children:[E.map((r,t)=>e.jsxs("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center space-x-4 flex-1",children:[e.jsx("span",{className:"w-8 h-8 rounded-full bg-[#FF6600] text-white flex items-center justify-center font-bold",children:t+1}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-start gap-3",children:[r.bannerUrl&&e.jsx("div",{className:"relative w-24 h-16 flex-shrink-0 rounded overflow-hidden border border-gray-200",children:e.jsx("img",{src:r.bannerUrl,alt:r.title,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-[#003366]",children:r.title}),r.duration&&e.jsxs("p",{className:"text-sm text-gray-500",children:["Dura√ß√£o: ",r.duration]}),r.videoUrl&&e.jsx("p",{className:"text-xs text-gray-400 mt-1 truncate max-w-md",children:r.videoUrl})]})]})})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:[r._count?.comments||0," coment√°rios"]}),e.jsx("button",{onClick:()=>K(r.id),className:"text-blue-600 hover:text-blue-800 font-medium text-sm",children:"Editar"}),e.jsx("button",{onClick:()=>Q(r.id),className:"text-red-600 hover:text-red-800 font-medium text-sm",children:"Excluir"})]})]},r.id)),E.length===0&&e.jsx("p",{className:"text-center text-gray-500 py-24",children:'Nenhuma aula adicionada ainda. Clique em "Adicionar Aula" para come√ßar.'})]})]})]}),e.jsx(le,{})]})}export{ve as default};
